<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dréba VTC - Réserver en un clic une course</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Leaflet CSS pour OpenStreetMap -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* Glass effect vert pour navbar */
        .glass-effect-blue {
            background: rgba(16, 185, 129, 0.1);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Animations modernes */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.4), 0 0 40px rgba(5, 150, 105, 0.2); }
            50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.8), 0 0 80px rgba(5, 150, 105, 0.4); }
        }
        
        @keyframes fluid-gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Animations modernes VTC 2025 */
        @keyframes vtc-shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        @keyframes vtc-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        
        @keyframes vtc-drive {
            0% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(5px) translateY(-2px); }
            50% { transform: translateX(0) translateY(0); }
            75% { transform: translateX(-5px) translateY(2px); }
            100% { transform: translateX(0) translateY(0); }
        }
        
        @keyframes vtc-glow {
            0%, 100% { 
                filter: drop-shadow(0 0 10px rgba(16, 185, 129, 0.5)) drop-shadow(0 0 20px rgba(5, 150, 105, 0.3));
            }
            50% { 
                filter: drop-shadow(0 0 20px rgba(16, 185, 129, 0.8)) drop-shadow(0 0 40px rgba(5, 150, 105, 0.5));
            }
        }
        
        @keyframes vtc-gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes vtc-particles {
            0% { transform: translateY(0) translateX(0) scale(0); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(-100px) translateX(var(--tx)) scale(1); opacity: 0; }
        }
        
        .vtc-shimmer {
            position: relative;
            overflow: hidden;
        }
        
        .vtc-shimmer::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: vtc-shimmer 3s infinite;
        }
        
        .vtc-pulse {
            animation: vtc-pulse 2s ease-in-out infinite;
        }
        
        .vtc-drive {
            animation: vtc-drive 3s ease-in-out infinite;
        }
        
        .vtc-glow {
            animation: vtc-glow 2s ease-in-out infinite;
        }
        
        /* Effet de particules animées en arrière-plan */
        .vtc-particles-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        
        .vtc-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.8), transparent);
            border-radius: 50%;
            animation: vtc-particles 8s infinite;
            opacity: 0;
        }
        
        .vtc-particle:nth-child(1) { --tx: 20px; animation-delay: 0s; left: 10%; }
        .vtc-particle:nth-child(2) { --tx: -30px; animation-delay: 1s; left: 20%; }
        .vtc-particle:nth-child(3) { --tx: 40px; animation-delay: 2s; left: 30%; }
        .vtc-particle:nth-child(4) { --tx: -25px; animation-delay: 3s; left: 40%; }
        .vtc-particle:nth-child(5) { --tx: 35px; animation-delay: 4s; left: 50%; }
        .vtc-particle:nth-child(6) { --tx: -20px; animation-delay: 5s; left: 60%; }
        .vtc-particle:nth-child(7) { --tx: 30px; animation-delay: 6s; left: 70%; }
        .vtc-particle:nth-child(8) { --tx: -40px; animation-delay: 7s; left: 80%; }
        
        /* Animation de flourescence pour les icônes */
        @keyframes vtc-icon-glow {
            0%, 100% { 
                filter: drop-shadow(0 0 5px rgba(16, 185, 129, 0.5));
                transform: scale(1);
            }
            50% { 
                filter: drop-shadow(0 0 15px rgba(16, 185, 129, 0.9));
                transform: scale(1.1);
            }
        }
        
        .vtc-icon-animated {
            animation: vtc-icon-glow 2s ease-in-out infinite;
        }
        
        /* Animation de vague pour les sections */
        @keyframes vtc-wave {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(10px) translateY(-5px); }
            100% { transform: translateX(0) translateY(0); }
        }
        
        .vtc-wave {
            animation: vtc-wave 4s ease-in-out infinite;
        }
        
        /* Styles pour la vidéo hero */
        video {
            filter: brightness(1.05) contrast(1.1);
            transition: filter 0.3s ease;
        }
        
        video:hover {
            filter: brightness(1.1) contrast(1.15);
        }
        
        /* Animations marketing immersives pour les taxis */
        @keyframes taxi-showcase-float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }
        
        @keyframes taxi-glow-pulse {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.4), 0 0 60px rgba(5, 150, 105, 0.2);
            }
            50% { 
                box-shadow: 0 0 50px rgba(16, 185, 129, 0.8), 0 0 100px rgba(5, 150, 105, 0.4);
            }
        }
        
        @keyframes image-zoom {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .taxi-showcase-card {
            position: relative;
            overflow: hidden;
            border-radius: 24px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            background: white;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .taxi-showcase-card:hover {
            transform: translateY(-15px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0,0,0,0.3), 0 0 40px rgba(16, 185, 129, 0.5);
        }
        
        .taxi-showcase-image-container {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            border-radius: 24px 24px 0 0;
        }
        
        .taxi-showcase-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            transition: opacity 0.8s ease-in-out, transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Responsive pour les images des cartes */
        @media (max-width: 1024px) {
            .taxi-showcase-image-container {
                height: 350px;
            }
        }
        
        @media (max-width: 768px) {
            .taxi-showcase-image-container {
                height: 300px;
            }
            
            .taxi-showcase-image {
                object-fit: cover;
                object-position: center;
            }
        }
        
        @media (max-width: 640px) {
            .taxi-showcase-image-container {
                height: 280px;
                min-height: 280px;
            }
            
            .taxi-showcase-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                object-position: center;
                display: block;
            }
        }
        
        @media (max-width: 480px) {
            .taxi-showcase-image-container {
                height: 250px;
                min-height: 250px;
            }
        }
        
        .taxi-showcase-image.fade-in {
            opacity: 1;
            transform: scale(1);
        }
        
        .taxi-showcase-image.fade-out {
            opacity: 0;
            transform: scale(1.1);
        }
        
        .taxi-showcase-card:hover .taxi-showcase-image {
            transform: scale(1.1);
        }
        
        .taxi-showcase-content {
            padding: 2rem;
            background: white;
            flex: 1;
            display: flex;
            flex-direction: column;
            border-radius: 0 0 24px 24px;
        }
        
        .taxi-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.875rem;
            z-index: 3;
            animation: taxi-glow-pulse 3s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5);
            pointer-events: none;
        }
        
        .taxi-price-tag {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-radius: 16px;
            display: inline-block;
            margin-top: 1rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .taxi-features-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }
        
        .taxi-features-list li {
            padding: 0.5rem 0;
            color: #374151;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .taxi-features-list li::before {
            content: '✓';
            color: #10b981;
            font-weight: bold;
            margin-right: 0.75rem;
            font-size: 1.2rem;
        }
        
        .taxi-cta-button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 14px 32px;
            border-radius: 50px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .taxi-cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .taxi-cta-button:hover::before {
            left: 100%;
        }
        
        .taxi-cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.6);
        }
        
        .taxi-showcase-section {
            position: relative;
            padding: 6rem 0;
            overflow: hidden;
        }
        
        .taxi-showcase-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 70% 50%, rgba(5, 150, 105, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        .taxi-card-popular {
            position: relative;
        }
        
        .taxi-card-popular::after {
            content: 'POPULAIRE';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 8px 24px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 0.75rem;
            letter-spacing: 2px;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.5);
            animation: taxi-glow-pulse 2s ease-in-out infinite;
        }
        
        @media (max-width: 1024px) {
            .taxi-showcase-card {
                height: auto !important;
                min-height: 550px;
            }
            
            .taxi-showcase-content {
                padding: 1.5rem;
            }
            
            .taxi-showcase-content h3 {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 768px) {
            .taxi-showcase-card {
                height: auto !important;
                min-height: 500px;
            }
            
            .taxi-showcase-content {
                padding: 1rem;
            }
            
            .taxi-showcase-content h3 {
                font-size: 1.75rem;
            }
            
            .taxi-features-list {
                font-size: 0.85rem;
            }
        }
        
        @media (max-width: 640px) {
            .taxi-showcase-card {
                height: auto !important;
                min-height: auto;
            }
            
            .taxi-showcase-image-container {
                flex-shrink: 0;
            }
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        /* Animated Gradient Cards */
        [class*="bg-gradient-to-br"] {
            background-size: 200% 200%;
            animation: fluid-gradient 8s ease infinite;
        }
        
        [class*="bg-gradient-to-br"]:hover {
            animation: fluid-gradient 8s ease infinite, pulse-glow 2s ease-in-out infinite;
        }
        
        .card-hover {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .card-hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .card-hover:hover::before {
            left: 100%;
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(16, 185, 129, 0.3), 0 0 30px rgba(5, 150, 105, 0.2);
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .text-gradient {
            background: linear-gradient(135deg, #10b981, #059669, #34d399, #6ee7b7);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: vtc-gradient-shift 3s ease infinite;
        }
        
        .text-gradient-strong {
            background: linear-gradient(135deg, #10b981, #059669, #047857);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: vtc-gradient-shift 4s ease infinite;
        }
        
        .cta-button {
            background: linear-gradient(135deg, #10b981, #059669, #047857);
            background-size: 200% 200%;
            border: none;
            border-radius: 50px;
            padding: 15px 40px;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: vtc-gradient-shift 3s ease infinite;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }
        
        .cta-button:hover::before {
            left: 100%;
        }
        
        .cta-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.5), 0 0 20px rgba(5, 150, 105, 0.3);
            animation: vtc-gradient-shift 1.5s ease infinite, vtc-pulse 1s ease infinite;
        }
        
        .cta-button:active {
            transform: translateY(0) scale(0.98);
        }
        
        /* Fluid Pagination - Redesigned */
        .pagination {
            position: fixed;
            left: 2rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 40;
            list-style: none;
            padding: 16px 8px;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.7);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(16, 185, 129, 0.1);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .pagination li {
            position: relative;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            padding: 8px;
            border-radius: 8px;
        }
        
        .pagination li::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(16, 185, 129, 0.4);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
        }
        
        .pagination li:hover {
            background: rgba(16, 185, 129, 0.05);
            transform: translateX(4px);
        }
        
        .pagination li:hover::before,
        .pagination li.active::before {
            width: 12px;
            height: 12px;
            background: #10b981;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
        }
        
        .pagination li.active {
            background: rgba(16, 185, 129, 0.1);
        }
        
        .pagination li.active::before {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .pagination .hover-text {
            position: absolute;
            left: 36px;
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            background: rgba(15, 23, 42, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .pagination .hover-text::after {
            content: '';
            position: absolute;
            left: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
            border-right: 4px solid rgba(15, 23, 42, 0.95);
        }
        
        .pagination li:hover .hover-text {
            opacity: 1;
            transform: translateY(-50%) translateX(4px);
        }
        
        @media (max-width: 1024px) {
            .pagination {
                display: none;
            }
        }
        
        /* Custom CSS for elements that can't be done with Tailwind */
        .map-container {
            height: 600px;
            width: 100%;
            border-radius: 1rem;
            overflow: hidden;
            z-index: 1;
            position: relative;
            background: #e5e7eb;
        }
        
        #map {
            height: 100% !important;
            width: 100% !important;
            min-height: 600px !important;
            border-radius: 1rem;
            position: relative !important;
            z-index: 1;
        }
        
        /* Assurer que Leaflet charge les tuiles correctement */
        .leaflet-container {
            height: 100% !important;
            width: 100% !important;
            background-color: #e5e7eb !important;
        }
        
        .leaflet-tile-container img {
            max-width: none !important;
            max-height: none !important;
        }
        
        @media (max-width: 1024px) {
            .map-container {
                height: 500px;
            }
            #map {
                min-height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            .map-container {
                height: 400px;
            }
            #map {
                min-height: 400px;
            }
        }
        
        /* Styles Leaflet pour s'assurer que la carte est visible */
        .leaflet-container {
            height: 100%;
            width: 100%;
            z-index: 1;
        }
        
        /* Styles pour les marqueurs personnalisés */
        .custom-marker {
            background: white;
            border-radius: 50%;
            padding: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .marker-available {
            border: 3px solid #10b981;
        }
        
        .marker-reserved {
            border: 3px solid #f59e0b;
        }
        
        .driver-available {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); }
            100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
        }
        
        .driver-reserved {
            animation: pulse-yellow 2s infinite;
        }
        
        @keyframes pulse-yellow {
            0% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(250, 204, 21, 0); }
            100% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0); }
        }
        
        .dark-mode {
            background-color: #1a202c;
            color: #f7fafc;
        }
        
        .language-selector {
            transition: all 0.3s ease;
        }
        
        .language-selector:hover {
            transform: scale(1.1);
        }
        
        .slide-in {
            animation: slideIn 0.5s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .slide-out {
            animation: slideOut 0.5s forwards;
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }
        
        .price-calculator {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .price-calculator:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        /* Styles pour les sliders (input range) */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        
        input[type="range"]::-webkit-slider-track {
            background: #d1fae5;
            height: 8px;
            border-radius: 5px;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(135deg, #10b981, #059669);
            height: 20px;
            width: 20px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.4);
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.6);
        }
        
        input[type="range"]::-moz-range-track {
            background: #d1fae5;
            height: 8px;
            border-radius: 5px;
        }
        
        input[type="range"]::-moz-range-thumb {
            background: linear-gradient(135deg, #10b981, #059669);
            height: 20px;
            width: 20px;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.4);
            transition: all 0.3s ease;
        }
        
        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.6);
        }
        
        .carousel-item {
            transition: transform 0.5s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 font-sans relative">
    <!-- Particules animées en arrière-plan -->
    <div class="vtc-particles-bg">
        <div class="vtc-particle"></div>
        <div class="vtc-particle"></div>
        <div class="vtc-particle"></div>
        <div class="vtc-particle"></div>
        <div class="vtc-particle"></div>
        <div class="vtc-particle"></div>
        <div class="vtc-particle"></div>
        <div class="vtc-particle"></div>
    </div>
    <!-- Header with Language Selector and Dark Mode Toggle -->
    <header class="fixed top-0 w-full z-50 glass-effect-blue shadow-lg">
        <div class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-6">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center flex-shrink-0">
                    <img src="Icon/Logo.png" alt="Dréba VTC Logo" class="h-10 w-auto">
                    <h1 class="ml-3 text-xl font-bold text-gradient whitespace-nowrap">Dréba VTC</h1>
            </div>
            
                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex items-center space-x-1 flex-1 justify-center ml-4">
                    <a href="#home" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">Accueil</a>
                    <a href="#services" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">Services</a>
                    <a href="#booking" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">Réserver</a>
                    <a href="#pricing" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">Véhicules</a>
                    <a href="#rental" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">Devenir Chauffeur</a>
                    <button id="driverLoginBtn" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">Connexion Chauffeur</button>
                    <a href="#about" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">À propos</a>
                    <a href="#contact" class="px-3 py-2 text-gray-700 hover:text-green-500 transition font-medium whitespace-nowrap vtc-drive">Contact</a>
                </nav>
                
                <div class="flex items-center space-x-2 flex-shrink-0">
                    <button id="adminBtn" class="hidden md:flex items-center space-x-1 px-3 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition text-white text-sm vtc-pulse" title="Panneau Admin">
                        <i class="fas fa-user-shield"></i>
                        <span class="hidden lg:inline">Admin</span>
                    </button>
                    <div class="relative hidden md:block">
                        <button id="languageBtn" class="flex items-center space-x-1 px-3 py-2 bg-gradient-to-r from-green-600 to-emerald-600 rounded-lg hover:from-green-700 hover:to-emerald-700 transition text-white text-sm vtc-pulse">
                        <i class="fas fa-globe"></i>
                            <span class="hidden lg:inline">Français</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                        <div id="languageDropdown" class="hidden absolute right-0 mt-2 w-48 glass-effect rounded-md shadow-lg z-10">
                        <div class="py-1">
                                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-green-50 transition-colors">Français</a>
                                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-green-50 transition-colors">English</a>
                                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-green-50 transition-colors">Haussa</a>
                                <a href="#" class="block px-4 py-2 text-gray-800 hover:bg-green-50 transition-colors">العربية</a>
                        </div>
                    </div>
                </div>
                
                    <button id="darkModeToggle" class="p-2 rounded-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition text-white vtc-pulse">
                    <i class="fas fa-moon"></i>
                </button>
                
                    <button id="menuToggle" class="lg:hidden p-2 rounded-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 transition text-white vtc-pulse">
                    <i class="fas fa-bars"></i>
                </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden lg:hidden bg-gradient-to-r from-green-600 to-emerald-600">
            <div class="max-w-7xl mx-auto px-4 py-2">
                <nav class="flex flex-col space-y-2">
                    <a href="#home" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive">Accueil</a>
                    <a href="#services" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive">Services</a>
                    <a href="#booking" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive">Réserver</a>
                    <a href="#pricing" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive">Véhicules</a>
                    <a href="#rental" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive">Location</a>
                    <button id="driverLoginBtnMobile" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive text-left w-full">Connexion Chauffeur</button>
                    <a href="#about" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive">À propos</a>
                    <a href="#contact" class="px-3 py-2 text-white hover:bg-green-700 rounded transition vtc-drive">Contact</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Pagination verticale -->
    <ul class="pagination">
        <li data-section="#home" class=""><span class="hover-text">Accueil</span></li>
        <li data-section="#services" class=""><span class="hover-text">Services</span></li>
        <li data-section="#booking" class=""><span class="hover-text">Réservation</span></li>
        <li data-section="#pricing" class=""><span class="hover-text">Véhicules</span></li>
        <li data-section="#rental" class=""><span class="hover-text">Devenir Dréba</span></li>
        <li data-section="#about" class=""><span class="hover-text">À propos</span></li>
        <li data-section="#contact" class=""><span class="hover-text">Contact</span></li>
    </ul>

    <!-- Hero Section -->
    <section id="home" class="py-32 md:py-40 mt-16 text-white relative overflow-hidden vtc-shimmer">
        <!-- Background Image -->
        <div class="absolute inset-0" style="background-image: url('Icon/building_image.png'); background-size: cover; background-position: center; background-repeat: no-repeat; opacity: 0.4;"></div>
        <!-- Green Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-r from-green-600/90 via-emerald-500/90 to-teal-500/90"></div>
        <!-- Content -->
        <div class="container mx-auto px-4 relative z-10">
            <!-- Text Content -->
            <div class="mb-8 md:mb-12 text-center">
                <h2 class="text-3xl md:text-4xl lg:text-5xl xl:text-6xl font-bold mb-4 leading-tight">
                    Révolutionnez votre mobilité avec 
                    <span class="text-gradient bg-white bg-clip-text text-transparent">Dréba VTC</span>
                </h2>
                <p class="text-base md:text-lg lg:text-xl mb-6 text-green-50 max-w-3xl mx-auto">
                    Pionnier de la révolution de la mobilité au Niger. Réservez un taxi en quelques clics, où que vous soyez.
                </p>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 justify-center">
                    <a href="#booking" class="cta-button pulse-glow text-base px-8 py-3 text-center">
                        <i class="fas fa-taxi mr-2"></i>Réserver maintenant
                    </a>
                    <a href="#services" class="border-2 border-white text-white px-8 py-3 rounded-lg font-semibold text-center hover:bg-white hover:text-green-600 transition vtc-pulse text-base">
                        <i class="fas fa-info-circle mr-2"></i>Nos services
                    </a>
                </div>
            </div>
            
            <!-- Video Container -->
            <div class="relative w-full rounded-lg shadow-2xl overflow-hidden" style="max-height: 900px; min-height: 600px;">
                <!-- Video -->
                <video autoplay loop muted playsinline class="w-full h-full object-cover" style="max-height: 900px; min-height: 600px;">
                    <source src="Photo Taxi/Taxi simple video.mp4" type="video/mp4">
                    Votre navigateur ne supporte pas la lecture de vidéos.
                </video>
            </div>
        </div>
    </section>

    <!-- Immersive Taxi Showcase Section -->
    <section id="pricing" class="taxi-showcase-section bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 relative">
        <div class="container mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-5xl md:text-6xl font-bold mb-6 text-gradient-strong">Choisissez Votre Expérience</h2>
                <p class="text-xl text-gray-700 max-w-3xl mx-auto">Découvrez notre flotte premium et réservez le taxi parfait pour votre trajet</p>
                    </div>
                    
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-6 mb-12">
                <!-- Taxi Simple - Immersive Card -->
                <div class="taxi-showcase-card taxi-showcase-card-simple">
                    <div class="taxi-showcase-image-container">
                        <div class="taxi-badge">ÉCONOMIQUE</div>
                        <img id="taxi-simple-slider" src="Photo Taxi/Taxi Simple (1).jpeg" alt="Taxi Simple" class="taxi-showcase-image fade-in">
                    </div>
                    <div class="taxi-showcase-content">
                        <h3 class="text-3xl font-bold text-gradient-strong mb-2">Taxi Simple</h3>
                        <p class="text-gray-600 mb-4">Parfait pour vos déplacements quotidiens</p>
                        <ul class="taxi-features-list mb-4" style="color: #374151;">
                            <li>Véhicule fiable et économique</li>
                            <li>Service rapide et efficace</li>
                            <li>Facturation par trajet</li>
                            <li>Conducteurs certifiés</li>
                    </ul>
                        <button class="taxi-cta-button w-full" onclick="scrollToBooking('simple')">
                            Réserver maintenant
                        </button>
                    </div>
                    </div>
                    
                <!-- Taxi Standard - Immersive Card (POPULAIRE) -->
                <div class="taxi-showcase-card taxi-showcase-card-standard taxi-card-popular">
                    <div class="taxi-showcase-image-container">
                        <img id="taxi-standard-slider" src="Photo Taxi/Taxi Standard.jpeg" alt="Taxi Standard" class="taxi-showcase-image fade-in">
                    </div>
                    <div class="taxi-showcase-content">
                        <h3 class="text-3xl font-bold text-gradient-strong mb-2">Taxi Standard</h3>
                        <p class="text-gray-600 mb-4">Le choix adapté pour votre confort</p>
                        <ul class="taxi-features-list mb-4" style="color: #374151;">
                            <li>Véhicule confortable et moderne</li>
                            <li>Service premium garanti</li>
                            <li>Facturation par trajet</li>
                            <li>Climatisation inclus</li>
                        </ul>
                        <button class="taxi-cta-button w-full" style="background: linear-gradient(135deg, #f59e0b, #d97706);" onclick="scrollToBooking('standard')">
                            Réserver maintenant
                    </button>
                    </div>
                </div>
                
                <!-- Taxi VIP - Immersive Card -->
                <div class="taxi-showcase-card taxi-showcase-card-vip">
                    <div class="taxi-showcase-image-container">
                        <div class="taxi-badge" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">PREMIUM</div>
                        <img id="taxi-vip-slider" src="Photo Taxi/Taxi VIP (1).jpeg" alt="Taxi VIP" class="taxi-showcase-image fade-in">
                    </div>
                    <div class="taxi-showcase-content">
                        <h3 class="text-3xl font-bold text-gradient-strong mb-2">Taxi VIP</h3>
                        <p class="text-gray-600 mb-4">L'excellence à chaque trajet</p>
                        <ul class="taxi-features-list mb-4" style="color: #374151;">
                            <li>Véhicule haut de gamme luxueux</li>
                            <li>Service exclusif et personnalisé</li>
                            <li>Confort et élégance maximaux</li>
                            <li>Chauffeur professionnel dédié</li>
                        </ul>
                        <button class="taxi-cta-button w-full" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);" onclick="scrollToBooking('vip')">
                            Réserver maintenant
                        </button>
                    </div>
                </div>
                    </div>
                    
                        </div>
    </section>

    <!-- Booking Section -->
    <section id="booking" class="py-12 bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12 text-gradient-strong">Réserver un Véhicule</h2>
            
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="flex flex-col lg:flex-row">
                    <!-- Map Section -->
                    <div class="lg:w-3/4 p-2 lg:p-3">
                        <div class="map-container relative">
                            <div id="map"></div>
                            
                            <!-- Contrôles de la carte -->
                            <div class="absolute bottom-4 left-4 z-[1000] flex flex-col gap-2">
                                <!-- Bouton utiliser ma position -->
                                <button id="useMyLocationBtn" class="px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg shadow-lg flex items-center hover:from-green-700 hover:to-emerald-700 transition transform hover:scale-105" title="Utiliser ma position actuelle comme point de départ">
                                    <i class="fas fa-map-marker-alt mr-2"></i>
                                    <span class="hidden md:inline">Ma position</span>
                                </button>
                                
                                <!-- Indicateur de précision -->
                                <div id="accuracyIndicator" class="px-3 py-2 bg-white rounded-lg shadow-lg text-sm hidden">
                                    <div class="flex items-center">
                                        <i class="fas fa-bullseye text-green-600 mr-2"></i>
                                        <span class="text-gray-700">Précision: <span id="accuracyValue" class="font-semibold">-</span></span>
                    </div>
                    </div>
                </div>
                
                            <!-- Instructions -->
                            <div class="absolute top-4 right-4 z-[1000] bg-white rounded-lg shadow-lg p-3 max-w-xs hidden md:block" id="mapInstructions">
                                <p class="text-sm text-gray-700 mb-2">
                                    <i class="fas fa-info-circle text-blue-600 mr-1"></i>
                                    <strong>Instructions :</strong>
                                </p>
                                <ul class="text-xs text-gray-600 space-y-1">
                                    <li>• Cliquez sur la carte pour définir le départ</li>
                                    <li>• Cliquez à nouveau pour définir la destination</li>
                                    <li>• Utilisez "Ma position" pour utiliser votre localisation GPS</li>
                                </ul>
                    </div>
                        </div>
                            
                        <div class="mt-3 flex flex-wrap gap-2">
                            <button id="clearMarkersBtn" class="px-4 py-2 bg-red-100 text-red-600 rounded-lg flex items-center hover:bg-red-200 transition">
                                <i class="fas fa-eraser mr-2"></i> Effacer
                            </button>
                    </div>
                    </div>
                    
                    <!-- Booking Form -->
                    <div class="lg:w-1/4 p-4 lg:p-6 bg-gradient-to-br from-green-600 via-emerald-600 to-teal-600 text-white vtc-shimmer">
                        <h3 class="text-xl font-semibold mb-4">Détails de la réservation</h3>
                        
                        <form id="bookingForm" onsubmit="return false;">
                            <div class="mb-4">
                                <label class="block mb-2">Type de véhicule</label>
                                <div class="flex space-x-2">
                                    <button type="button" class="w-full py-2 bg-green-700 rounded-lg border-2 border-green-400 focus:border-white vehicle-type vtc-pulse" data-type="taxi">
                                        <i class="fas fa-taxi mr-2"></i> Taxi
                                    </button>
                        </div>
                    </div>
                    
                        <div class="mb-4">
                                <label class="block mb-2">Catégorie</label>
                                <select id="taxiCategorySelect" class="w-full p-2 rounded-lg bg-green-700 border border-green-500" required>
                                    <option value="simple">Taxi Simple</option>
                                    <option value="standard">Taxi Standard</option>
                                    <option value="vip">Taxi VIP</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block mb-2">
                                    <i class="fas fa-map-marker-alt mr-1"></i> Point de départ
                                </label>
                                <input type="text" id="pickupAddressInput" class="w-full p-2 rounded-lg bg-green-700 border border-green-500" placeholder="Saisissez une adresse, cliquez sur la carte ou utilisez votre position">
                                <p class="text-xs text-green-200 mt-1" id="pickupCoords">Non défini</p>
                        </div>
                            
                            <div class="mb-4">
                                <label class="block mb-2">
                                    <i class="fas fa-flag-checkered mr-1"></i> Destination
                                </label>
                                <input type="text" id="destinationAddressInput" class="w-full p-2 rounded-lg bg-green-700 border border-green-500" placeholder="Saisissez une adresse ou cliquez sur la carte">
                                <p class="text-xs text-green-200 mt-1" id="destinationCoords">Non défini</p>
                        </div>
                            
                            <div class="mb-4">
                                <label class="block mb-2">Date et heure</label>
                                <div class="flex space-x-2">
                                    <input type="date" class="flex-1 p-2 rounded-lg bg-green-700 border border-green-500">
                                    <input type="time" class="flex-1 p-2 rounded-lg bg-green-700 border border-green-500">
                    </div>
                </div>
                            
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2"> J'ai des Passagers avec moi
                                </label>
            </div>
            
                            <button type="button" id="findVehicleBtn" class="w-full py-3 bg-white text-green-600 rounded-lg font-semibold hover:bg-gray-100 transition vtc-pulse">
                                <i class="fas fa-search mr-2"></i> Trouver un véhicule
                            </button>
                        </form>
                        
                        <div class="mt-6 bg-green-700 p-4 rounded-lg vtc-shimmer">
                            <h4 class="font-semibold mb-3 flex items-center justify-between">
                                <span>Véhicules disponibles</span>
                                <span id="vehiclesCount" class="text-sm font-normal text-green-200">(0)</span>
                            </h4>
                            <div id="selectedVehicle" class="space-y-3 max-h-96 overflow-y-auto">
                                <p class="text-green-200 text-sm text-center py-4">Aucun véhicule trouvé. Cliquez sur "Trouver un véhicule" pour rechercher.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Driver Registration Section -->
    <section id="rental" class="py-12 bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-bold mb-4 text-gradient-strong">Rejoindre Dréba VTC</h2>
                <p class="text-xl text-gray-700 max-w-3xl mx-auto">Complétez vos informations pour valider votre profil chauffeur et commencer à gagner avec nous</p>
            </div>
            
            <!-- Driver Registration Form -->
            <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden vtc-shimmer">
                <form id="driverRegistrationForm" class="p-6 md:p-8">
                    <!-- Informations personnelles -->
            <div class="mb-8">
                        <div class="flex items-center mb-6">
                            <i class="fas fa-user-circle text-green-600 text-2xl mr-3"></i>
                            <h3 class="text-2xl font-bold text-gradient-strong">Informations personnelles</h3>
            </div>
            
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block mb-2 text-sm font-semibold text-gray-700">Prénom <span class="text-red-500">*</span></label>
                                <input type="text" id="firstName" name="firstName" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="Votre prénom">
                                    </div>
                                        <div>
                                <label class="block mb-2 text-sm font-semibold text-gray-700">Nom <span class="text-red-500">*</span></label>
                                <input type="text" id="lastName" name="lastName" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="Votre nom">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Adresse email (optionnel)</label>
                            <input type="email" id="email" name="email" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="exemple@email.com">
                        </div>
                        
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Numéro de téléphone Niger <span class="text-red-500">*</span></label>
                            <div class="flex">
                                <div class="px-4 py-3 bg-green-50 border-2 border-r-0 border-gray-300 rounded-l-lg text-green-700 font-bold">
                                    +227
                                    </div>
                                <input type="tel" id="phone" name="phone" required maxlength="8" pattern="[0-9]{8}" class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-r-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="12345678">
                                </div>
                            <p class="text-xs text-gray-500 mt-1">8 chiffres requis</p>
                </div>
                
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Numéro de permis nigérien <span class="text-red-500">*</span></label>
                            <input type="text" id="license" name="license" required minlength="6" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition uppercase" placeholder="ABC12345">
                </div>
            </div>
            
                    <!-- Informations véhicule -->
                    <div class="mb-8 border-t-2 border-gray-200 pt-8">
                        <div class="flex items-center mb-6">
                            <i class="fas fa-taxi text-green-600 text-2xl mr-3"></i>
                            <h3 class="text-2xl font-bold text-gradient-strong">Informations véhicule</h3>
                            </div>
                            
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Plaque d'immatriculation <span class="text-red-500">*</span></label>
                            <input type="text" id="plate" name="plate" required minlength="5" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition uppercase" placeholder="43A 36A.82">
                            </div>
                            
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Type de service <span class="text-red-500">*</span></label>
                            <select id="serviceType" name="serviceType" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition">
                                <option value="simple">Taxi Simple</option>
                                <option value="standard">Taxi Standard</option>
                                <option value="vip">Taxi VIP</option>
                                    </select>
                            </div>
                            
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Marque et modèle <span class="text-red-500">*</span></label>
                            <input type="text" id="vehicleBrand" name="vehicleBrand" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="Ex: Toyota Corolla">
                    </div>
                    
                        <div id="colorField" class="mb-4 hidden">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Couleur <span class="text-red-500">*</span></label>
                            <input type="text" id="vehicleColor" name="vehicleColor" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="Ex: Noir">
                                </div>
                            </div>
                            
                    <!-- Sécurité du compte -->
                    <div class="mb-8 border-t-2 border-gray-200 pt-8">
                        <div class="flex items-center mb-6">
                            <i class="fas fa-lock text-green-600 text-2xl mr-3"></i>
                            <h3 class="text-2xl font-bold text-gradient-strong">Sécurité du compte</h3>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Code PIN (4-6 chiffres) <span class="text-red-500">*</span></label>
                            <div class="relative">
                                <input type="password" id="pin" name="pin" required minlength="4" maxlength="6" pattern="[0-9]{4,6}" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="••••">
                                <button type="button" onclick="togglePinVisibility('pin')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-green-600">
                                    <i class="fas fa-eye" id="pinEyeIcon"></i>
                                </button>
                                </div>
                            </div>
                            
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-semibold text-gray-700">Confirmez le code PIN <span class="text-red-500">*</span></label>
                            <div class="relative">
                                <input type="password" id="confirmPin" name="confirmPin" required minlength="4" maxlength="6" pattern="[0-9]{4,6}" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="••••">
                                <button type="button" onclick="togglePinVisibility('confirmPin')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-green-600">
                                    <i class="fas fa-eye" id="confirmPinEyeIcon"></i>
                                </button>
                                </div>
                                </div>
                            </div>
                            
                    <!-- Conditions d'utilisation -->
                    <div class="mb-8 border-t-2 border-gray-200 pt-8">
                        <div class="flex items-center mb-6">
                            <i class="fas fa-file-contract text-green-600 text-2xl mr-3"></i>
                            <h3 class="text-2xl font-bold text-gradient-strong">Conditions d'utilisation</h3>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg mb-4 border-l-4 border-blue-600">
                            <p class="text-sm text-gray-700 mb-3">
                                Pour devenir chauffeur Dréba VTC, vous devez accepter nos conditions d'utilisation, notamment le partage de votre localisation en temps réel pour la gestion de la flotte.
                            </p>
                            <button type="button" id="viewTermsBtn" class="text-blue-600 hover:text-blue-800 font-semibold text-sm underline">
                                <i class="fas fa-external-link-alt mr-1"></i>Lire les conditions d'utilisation
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <label class="flex items-start cursor-pointer">
                                <input type="checkbox" id="acceptTermsCheckbox" required class="mt-1 mr-3 w-5 h-5 text-green-600 border-gray-300 rounded focus:ring-green-500">
                                <span class="text-sm text-gray-700">
                                    <strong>J'accepte les conditions d'utilisation</strong> et autorise Dréba VTC à suivre ma localisation en temps réel. 
                                    <span class="text-red-500">*</span>
                                </span>
                            </label>
                                </div>
                            </div>
                            
                    <!-- Submit Button -->
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button type="submit" id="submitBtn" class="flex-1 px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg font-bold text-lg hover:from-green-700 hover:to-emerald-700 transition shadow-lg vtc-pulse">
                            <span id="submitText">S'inscrire</span>
                            <span id="submitLoader" class="hidden">
                                <i class="fas fa-spinner fa-spin mr-2"></i>Inscription en cours...
                            </span>
                        </button>
                        <button type="button" onclick="resetForm()" class="px-8 py-4 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition">
                            Réinitialiser
                            </button>
                        </div>
                    
                    <p class="text-center text-sm text-gray-600 mt-6">
                        Vous avez déjà un compte ? <a href="#contact" class="text-green-600 font-semibold hover:underline">Contactez-nous</a>
                    </p>
                </form>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-12 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12 text-gradient">À propos de Dréba VTC</h2>
            
            <div class="flex flex-col lg:flex-row items-center mb-12">
                <div class="lg:w-1/2 mb-8 lg:mb-0 lg:pr-8">
                    <h3 class="text-2xl font-semibold mb-4 text-gradient-strong">Pionnier de la Révolution de la Mobilité au Niger</h3>
                    <p class="text-gray-700 mb-4">Dréba VTC est le pionnier de la révolution de la mobilité au Niger. Nous transformons la façon dont les Nigériens se déplacent en offrant des solutions de mobilité modernes, sûres et accessibles à tous.</p>
                    <p class="text-gray-700 mb-4">Notre mission est de démocratiser la mobilité urbaine en mettant la technologie au service de tous. Grâce à notre plateforme innovante, nous connectons les passagers aux meilleurs conducteurs de la ville, garantissant un service de qualité supérieure.</p>
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-lg vtc-shimmer">
                        <h4 class="font-semibold mb-2 text-gradient-strong">Pourquoi choisir Dréba VTC ?</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-semibold text-green-600 mb-2">Innovation Technologique</h5>
                                <ul class="text-sm space-y-1">
                                    <li>✓ Application mobile intuitive</li>
                                    <li>✓ Suivi GPS en temps réel</li>
                                    <li>✓ Paiement électronique sécurisé</li>
                                    <li>✓ Système de notation transparent</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-semibold text-green-600 mb-2">Engagement Qualité</h5>
                                <ul class="text-sm space-y-1">
                                    <li>✓ Conducteurs certifiés et formés</li>
                                    <li>✓ Véhicules régulièrement inspectés</li>
                                    <li>✓ Service disponible 7h-23h</li>
                                    <li>✓ Support client réactif</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="lg:w-1/2">
                    <img src="Photo Taxi/freepik__candid-i-with-natural-textures-and-highly-realisti__72721.jpeg" alt="Dréba VTC - Équipe et Service" class="rounded-lg shadow-lg w-full card-hover object-cover" style="max-height: 600px;">
                </div>
            </div>
            
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 vtc-shimmer">
                <h3 class="text-xl font-semibold mb-4 text-center text-gradient-strong">Notre Vision</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow text-center card-hover">
                        <div class="text-green-600 mb-2 vtc-glow">
                            <i class="fas fa-rocket text-3xl"></i>
                        </div>
                        <p class="font-semibold">Innovation Continue</p>
                        <p class="text-sm text-gray-600 mt-2">Nous repoussons constamment les limites de la mobilité urbaine</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow text-center card-hover">
                        <div class="text-green-600 mb-2 vtc-glow">
                            <i class="fas fa-users text-3xl"></i>
                        </div>
                        <p class="font-semibold">Accessibilité pour Tous</p>
                        <p class="text-sm text-gray-600 mt-2">Une mobilité accessible à tous les Nigériens, partout et à tout moment</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow text-center card-hover">
                        <div class="text-green-600 mb-2 vtc-glow">
                            <i class="fas fa-leaf text-3xl"></i>
                        </div>
                        <p class="font-semibold">Mobilité Durable</p>
                        <p class="text-sm text-gray-600 mt-2">Contribuer à une mobilité plus écologique et responsable</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow text-center card-hover">
                        <div class="text-green-600 mb-2 vtc-glow">
                            <i class="fas fa-star text-3xl"></i>
                        </div>
                        <p class="font-semibold">Excellence du Service</p>
                        <p class="text-sm text-gray-600 mt-2">Un service de qualité supérieure à chaque trajet</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-12 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12 text-gradient">Nos Services</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Service 1 -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 shadow-md card-hover glass-effect vtc-shimmer">
                    <div class="text-green-600 mb-4 vtc-glow">
                        <i class="fas fa-taxi text-4xl vtc-icon-animated"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">Service de Taxi</h3>
                    <p class="text-gray-700">Réservez un taxi en temps réel avec notre système GPS avancé. Choisissez le véhicule le plus proche et suivez votre trajet en direct.</p>
                </div>
                
                <!-- Service 2 -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 shadow-md card-hover glass-effect vtc-shimmer">
                    <div class="text-green-600 mb-4 vtc-glow">
                        <i class="fas fa-truck text-4xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">Messagerie</h3>
                    <p class="text-gray-700">Envoyez ou Recevez vos colis rapidement et en toute sécurité .</p>
                </div>
                
                <!-- Service 3 -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 shadow-md card-hover glass-effect vtc-shimmer">
                    <div class="text-green-600 mb-4 vtc-glow">
                        <i class="fas fa-car text-4xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">Devenir Dréba</h3>
                    <p class="text-gray-700">Rejoignez notre équipe de chauffeurs professionnels et gagnez de l'argent en conduisant avec Dréba VTC. Inscription simple et rapide.</p>
                </div>
                
                <!-- Service 4 -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 shadow-md card-hover glass-effect vtc-shimmer">
                    <div class="text-green-600 mb-4 vtc-glow">
                        <i class="fas fa-shield-alt text-4xl vtc-icon-animated"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">Sécurité et Fiabilité</h3>
                    <p class="text-gray-700">Tous nos véhicules sont vérifiés et nos conducteurs certifiés pour garantir votre sécurité à chaque trajet.</p>
                </div>
                
                <!-- Service 5 -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 shadow-md card-hover glass-effect vtc-shimmer">
                    <div class="text-green-600 mb-4 vtc-glow">
                        <i class="fas fa-clock text-4xl vtc-icon-animated"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">Disponibilité 24/7</h3>
                    <p class="text-gray-700">Service disponible de 7h à 23h chaque jour pour répondre à tous vos besoins de mobilité en temps réel.</p>
                </div>
                
                <!-- Service 6 -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg p-6 shadow-md card-hover glass-effect vtc-shimmer">
                    <div class="text-green-600 mb-4 vtc-glow">
                        <i class="fas fa-mobile-alt text-4xl vtc-icon-animated"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-3">Application Mobile</h3>
                    <p class="text-gray-700">Réservez, suivez votre trajet et payez facilement grâce à notre application mobile intuitive et moderne.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-12 bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600 text-white vtc-shimmer">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12">Contactez-nous</h2>
            
            <div class="flex flex-col lg:flex-row">
                <div class="lg:w-1/2 mb-8 lg:mb-0 lg:pr-8">
                    <h3 class="text-xl font-semibold mb-4">Nos coordonnées</h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <div class="text-green-200 mr-4 mt-1 vtc-glow">
                                <i class="fas fa-map-marker-alt text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold">Adresse</h4>
                                <p>123 Avenue de la Mobilité, Niamey, Niger</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="text-green-200 mr-4 mt-1 vtc-glow">
                                <i class="fas fa-phone-alt text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold">Téléphone / WhatsApp</h4>
                                <p>
                                    <a href="tel:+22787776776" class="hover:text-green-200 transition underline">+227 87 77 67 76</a>
                                </p>
                                <p class="text-green-200 text-sm mt-2">
                                    <a href="https://wa.me/22787776776" target="_blank" class="hover:text-white transition underline flex items-center">
                                        <i class="fab fa-whatsapp mr-2"></i> WhatsApp: +227 87 77 67 76
                                    </a>
                                </p>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="text-green-200 mr-4 mt-1 vtc-glow">
                                <i class="fas fa-envelope text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold">Email</h4>
                                <p>
                                    <a href="mailto:taxidreba@gmail.com" class="hover:text-green-200 transition underline">taxidreba@gmail.com</a>
                                </p>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="text-green-200 mr-4 mt-1 vtc-glow">
                                <i class="fas fa-clock text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold">Heures d'ouverture</h4>
                                <p>Tous les jours: 7h00 - 23h00</p>
                                <p class="text-green-200">Service disponible 7 jours sur 7</p>
                                <p class="text-green-200">Support client 24/7</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold mb-4">Suivez-nous</h3>
                        <div class="flex space-x-4">
                            <a href="#" class="bg-green-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-green-800 transition vtc-pulse">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="bg-green-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-green-800 transition vtc-pulse">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="bg-green-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-green-800 transition vtc-pulse">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="bg-green-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-green-800 transition vtc-pulse">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="lg:w-1/2">
                    <div class="bg-white rounded-lg shadow-lg p-6 text-gray-800">
                        <h3 class="text-xl font-semibold mb-4">Envoyez-nous un message</h3>
                        
                        <form id="contactForm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block mb-1">Nom <span class="text-red-300">*</span></label>
                                    <input type="text" id="contactName" class="w-full p-2 border rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block mb-1">Prénom <span class="text-red-300">*</span></label>
                                    <input type="text" id="contactFirstName" class="w-full p-2 border rounded-lg" required>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <label class="block mb-1">Sujet <span class="text-red-300">*</span></label>
                                <select id="contactSubject" class="w-full p-2 border rounded-lg" required>
                                    <option value="Réservation">Réservation</option>
                                    <option value="Devenir Chauffeur">Devenir Chauffeur</option>
                                    <option value="Service client">Service client</option>
                                    <option value="Partenariat">Partenariat</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>
                            
                            <div class="mt-4">
                                <label class="block mb-1">Message <span class="text-red-300">*</span></label>
                                <textarea id="contactMessage" rows="4" class="w-full p-2 border rounded-lg" required></textarea>
                            </div>
                            
                            <button type="submit" class="w-full mt-4 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition vtc-pulse">
                                <i class="fas fa-paper-plane mr-2"></i>Envoyer le message
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-green-900 via-emerald-900 to-teal-900 text-white py-8 vtc-shimmer">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-2 mb-4">
                        <img src="Icon/Logo.png" alt="Dréba VTC Logo" class="h-10 w-auto">
                        <h3 class="text-xl font-bold text-gradient">Dréba VTC</h3>
                    </div>
                    <p class="text-green-300">Solution de mobilité moderne pour vos déplacements au Niger.</p>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
                    <div>
                        <h4 class="font-semibold mb-3">Liens rapides</h4>
                        <ul class="space-y-2">
                            <li><a href="#home" class="text-green-300 hover:text-white transition vtc-drive">Accueil</a></li>
                            <li><a href="#services" class="text-green-300 hover:text-white transition vtc-drive">Services</a></li>
                            <li><a href="#booking" class="text-green-300 hover:text-white transition vtc-drive">Réserver</a></li>
                            <li><a href="#pricing" class="text-green-300 hover:text-white transition vtc-drive">Véhicules</a></li>
                            <li><a href="#rental" class="text-green-300 hover:text-white transition vtc-drive">Devenir Chauffeur</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">Entreprise</h4>
                        <ul class="space-y-2">
                            <li><a href="#about" class="text-green-300 hover:text-white transition vtc-drive">À propos</a></li>
                            <li><a href="#contact" class="text-green-300 hover:text-white transition vtc-drive">Contact</a></li>
                            <li><a href="#" class="text-green-300 hover:text-white transition vtc-drive">Carrières</a></li>
                            <li><a href="#" class="text-green-300 hover:text-white transition vtc-drive">Blog</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold mb-3">Légal</h4>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-green-300 hover:text-white transition vtc-drive">Conditions d'utilisation</a></li>
                            <li><a href="#" class="text-green-300 hover:text-white transition vtc-drive">Politique de confidentialité</a></li>
                            <li><a href="#" class="text-green-300 hover:text-white transition vtc-drive">Cookies</a></li>
                            <li><a href="#" class="text-green-300 hover:text-white transition vtc-drive">FAQ</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-green-700 mt-8 pt-6 flex flex-col md:flex-row justify-between items-center">
                <p class="text-green-300 mb-4 md:mb-0">© 2023 Dréba VTC. Tous droits réservés.</p>
                
                <div class="flex space-x-4">
                    <a href="#" class="text-green-300 hover:text-white transition vtc-pulse">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="text-green-300 hover:text-white transition vtc-pulse">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" class="text-green-300 hover:text-white transition vtc-pulse">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-green-300 hover:text-white transition vtc-pulse">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bouton d'appel fixe -->
    <a href="tel:87776776" id="callButton" class="fixed bottom-6 right-6 z-50 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-2xl hover:from-green-700 hover:to-emerald-700 transition-all transform hover:scale-110 vtc-pulse" title="Appeler pour réserver">
        <i class="fas fa-phone text-2xl"></i>
    </a>
    <div class="fixed bottom-24 right-6 z-50 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg hidden" id="callTooltip">
        <p class="text-sm font-semibold">Appelez le <strong>87 77 67 76</strong></p>
        <p class="text-xs">Pour réserver votre taxi</p>
    </div>

    <!-- Modal Conditions d'utilisation pour chauffeurs -->
    <div id="termsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-2 sm:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto m-2 sm:m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4 sticky top-0 bg-white pb-4 border-b">
                    <h3 class="text-2xl font-bold text-gradient-strong">Conditions d'utilisation - Partage de localisation</h3>
                    <button id="closeTermsModal" class="text-gray-500 hover:text-gray-700 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4 text-gray-700">
                    <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-600">
                        <h4 class="font-bold text-green-800 mb-2">
                            <i class="fas fa-info-circle mr-2"></i>Important
                        </h4>
                        <p class="text-sm">En acceptant ces conditions, vous autorisez Dréba VTC à suivre votre localisation en temps réel pendant que vous êtes connecté en tant que chauffeur actif.</p>
                    </div>

                    <div>
                        <h4 class="font-semibold text-lg mb-2">1. Partage de localisation en temps réel</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm ml-4">
                            <li>Votre localisation GPS sera partagée avec l'administration Dréba VTC uniquement lorsque vous êtes connecté et disponible pour des courses.</li>
                            <li>La localisation est utilisée pour vous assigner des courses en fonction de votre proximité avec les clients.</li>
                            <li>Vous pouvez désactiver le partage de localisation à tout moment depuis votre tableau de bord, mais cela vous rendra indisponible pour les courses.</li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-semibold text-lg mb-2">2. Utilisation des données</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm ml-4">
                            <li>Vos données de localisation sont stockées de manière sécurisée et ne sont utilisées que dans le cadre du service Dréba VTC.</li>
                            <li>L'administration peut voir votre position en temps réel uniquement pour la gestion de la flotte et l'assignation de courses.</li>
                            <li>Aucune donnée de localisation n'est partagée avec des tiers sans votre consentement explicite.</li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-semibold text-lg mb-2">3. Attribution d'identifiant unique</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm ml-4">
                            <li>Après acceptation de ces conditions, un identifiant unique (ID) vous sera automatiquement attribué.</li>
                            <li>Cet ID vous permettra de vous connecter à votre compte chauffeur et facilitera la gestion de votre profil.</li>
                            <li>Votre ID sera envoyé par SMS à votre numéro de téléphone enregistré.</li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-semibold text-lg mb-2">4. Confidentialité et sécurité</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm ml-4">
                            <li>Nous nous engageons à protéger vos données personnelles conformément aux lois en vigueur au Niger.</li>
                            <li>Votre localisation n'est jamais partagée avec d'autres chauffeurs ou clients.</li>
                            <li>Vous avez le droit de demander l'accès, la modification ou la suppression de vos données à tout moment.</li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-semibold text-lg mb-2">5. Consentement</h4>
                        <p class="text-sm">En cochant la case ci-dessous, vous confirmez que vous avez lu, compris et accepté ces conditions d'utilisation concernant le partage de votre localisation en temps réel.</p>
                    </div>
                </div>

                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <label class="flex items-start cursor-pointer">
                        <input type="checkbox" id="acceptTerms" class="mt-1 mr-3 w-5 h-5 text-green-600 border-gray-300 rounded focus:ring-green-500">
                        <span class="text-sm text-gray-700">
                            <strong>J'accepte les conditions d'utilisation</strong> et autorise Dréba VTC à suivre ma localisation en temps réel pour la gestion de la flotte et l'assignation de courses. Je comprends que je peux désactiver cette fonctionnalité à tout moment.
                        </span>
                    </label>
                </div>

                <div class="flex gap-4 mt-6">
                    <button id="acceptTermsBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <i class="fas fa-check-circle mr-2"></i>Accepter et continuer
                    </button>
                    <button id="cancelTermsBtn" class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition">
                        Annuler
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Admin Dashboard -->
    <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-2 sm:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-hidden m-2 sm:m-4 flex flex-col modal-content">
            <div class="p-6 bg-gradient-to-r from-green-600 to-emerald-600 text-white">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl font-bold">Tableau de bord Admin - Gestion de la flotte</h3>
                        <p class="text-green-100 text-sm mt-1">Suivi en temps réel des chauffeurs</p>
                    </div>
                    <button id="closeAdminModal" class="text-white hover:text-green-200 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Statistiques principales -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-600">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs text-gray-600">Chauffeurs en ligne</p>
                                <p class="text-2xl font-bold text-green-600" id="activeDriversCount">0</p>
                            </div>
                            <i class="fas fa-user-check text-green-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-600">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs text-gray-600">Total chauffeurs</p>
                                <p class="text-2xl font-bold text-purple-600" id="totalDriversCount">0</p>
                            </div>
                            <i class="fas fa-users text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-600">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs text-gray-600">Total utilisateurs</p>
                                <p class="text-2xl font-bold text-blue-600" id="totalUsersCount">0</p>
                            </div>
                            <i class="fas fa-user-friends text-blue-600 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-600">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs text-gray-600">Réservations aujourd'hui</p>
                                <p class="text-2xl font-bold text-orange-600" id="todayReservationsCount">0</p>
                            </div>
                            <i class="fas fa-calendar-day text-orange-600 text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Statistiques d'appels par période -->
                <div class="bg-white border rounded-lg p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="font-semibold text-lg">Statistiques d'appels</h4>
                        <div class="flex gap-2">
                            <button id="statsPeriodDay" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-semibold hover:bg-green-700 transition stats-period-btn active">
                                Aujourd'hui
                            </button>
                            <button id="statsPeriodMonth" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-300 transition stats-period-btn">
                                Ce mois
                            </button>
                            <button id="statsPeriodYear" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-300 transition stats-period-btn">
                                Cette année
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-sm text-gray-600">Appels reçus</p>
                                <i class="fas fa-phone text-green-600"></i>
                            </div>
                            <p class="text-3xl font-bold text-green-600" id="callsReceivedCount">0</p>
                            <p class="text-xs text-gray-500 mt-1" id="callsPeriodLabel">Aujourd'hui</p>
                        </div>
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-sm text-gray-600">Réservations créées</p>
                                <i class="fas fa-calendar-check text-blue-600"></i>
                            </div>
                            <p class="text-3xl font-bold text-blue-600" id="reservationsCreatedCount">0</p>
                            <p class="text-xs text-gray-500 mt-1">Depuis le début</p>
                        </div>
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200">
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-sm text-gray-600">Taux de conversion</p>
                                <i class="fas fa-chart-line text-purple-600"></i>
                            </div>
                            <p class="text-3xl font-bold text-purple-600" id="conversionRate">0%</p>
                            <p class="text-xs text-gray-500 mt-1">Appels → Réservations</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="bg-white border rounded-lg overflow-hidden">
                            <div class="p-4 bg-gray-50 border-b flex items-center justify-between">
                                <h4 class="font-semibold">Carte des chauffeurs en temps réel</h4>
                                <div id="realtimeStatus" class="flex items-center space-x-2">
                                    <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                    <span class="text-xs text-gray-600">Suivi actif</span>
                                </div>
                            </div>
                            <div id="adminMap" style="height: 500px; width: 100%;"></div>
                        </div>
                    </div>
                    
                    <div class="lg:col-span-1">
                        <div class="bg-white border rounded-lg overflow-hidden">
                            <div class="p-4 bg-gray-50 border-b">
                                <h4 class="font-semibold">Liste des chauffeurs</h4>
                                <input type="text" id="driverSearch" placeholder="Rechercher..." class="w-full mt-2 px-3 py-2 border rounded-lg text-sm">
                            </div>
                            <div id="driversList" class="overflow-y-auto" style="max-height: 500px;">
                                <!-- Liste des chauffeurs sera générée dynamiquement -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 bg-white border rounded-lg p-4">
                    <h4 class="font-semibold mb-4">Nouvelle réservation par appel</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Numéro client</label>
                            <input type="tel" id="clientPhone" placeholder="87 77 67 76" class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Adresse de prise en charge</label>
                            <input type="text" id="pickupAddress" placeholder="Adresse..." class="w-full px-4 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Type de taxi</label>
                            <select id="reservationTaxiType" class="w-full px-4 py-2 border rounded-lg">
                                <option value="simple">Taxi Simple</option>
                                <option value="standard">Taxi Standard</option>
                                <option value="vip">Taxi VIP</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="assignDriverBtn" class="w-full px-6 py-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition">
                                <i class="fas fa-search-location mr-2"></i>Trouver le chauffeur le plus proche
                            </button>
                        </div>
                    </div>
                    <div id="assignedDriverInfo" class="mt-4 p-4 bg-green-50 rounded-lg hidden">
                        <h5 class="font-semibold text-green-800 mb-2">Chauffeur assigné :</h5>
                        <div id="assignedDriverDetails" class="text-sm"></div>
                        <button id="contactDriverBtn" class="mt-3 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            <i class="fas fa-phone mr-2"></i>Contacter le chauffeur
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Driver Dashboard Modal -->
    <div id="driverModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Tableau de bord chauffeur</h3>
                    <button id="closeDriverModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="bg-orange-50 p-4 rounded-lg mb-4">
                    <div class="flex items-center mb-2">
                        <div class="bg-orange-100 p-2 rounded-full mr-3">
                            <i class="fas fa-user text-orange-600"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">Mamadou Diallo</h4>
                            <p class="text-sm text-gray-600">Chauffeur Dréba VTC</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2 mt-3">
                        <div class="bg-white p-2 rounded text-center">
                            <p class="text-xs text-gray-500">Note moyenne</p>
                            <div class="flex justify-center text-yellow-400">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <p class="text-sm font-semibold">4.5/5</p>
                        </div>
                        <div class="bg-white p-2 rounded text-center">
                            <p class="text-xs text-gray-500">Courses ce mois</p>
                            <p class="text-xl font-semibold">24</p>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    <a href="#" class="flex items-center p-3 bg-orange-100 rounded-lg hover:bg-orange-200 transition">
                        <div class="bg-orange-600 text-white p-2 rounded-full mr-3">
                            <i class="fas fa-car"></i>
                        </div>
                        <span>Mes véhicules</span>
                    </a>
                    
                    <a href="#" class="flex items-center p-3 bg-orange-100 rounded-lg hover:bg-orange-200 transition">
                        <div class="bg-orange-600 text-white p-2 rounded-full mr-3">
                            <i class="fas fa-map-marked-alt"></i>
                        </div>
                        <span>Navigation GPS</span>
                    </a>
                    
                    <a href="#" class="flex items-center p-3 bg-orange-100 rounded-lg hover:bg-orange-200 transition">
                        <div class="bg-orange-600 text-white p-2 rounded-full mr-3">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span>Statistiques</span>
                    </a>
                    
                    <a href="#" class="flex items-center p-3 bg-orange-100 rounded-lg hover:bg-orange-200 transition">
                        <div class="bg-orange-600 text-white p-2 rounded-full mr-3">
                            <i class="fas fa-cog"></i>
                        </div>
                        <span>Paramètres</span>
                    </a>
                    
                    <a href="#" class="flex items-center p-3 bg-orange-100 rounded-lg hover:bg-orange-200 transition">
                        <div class="bg-orange-600 text-white p-2 rounded-full mr-3">
                            <i class="fas fa-sign-out-alt"></i>
                        </div>
                        <span>Déconnexion</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-2 sm:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Connexion</h3>
                    <button id="closeLoginModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block mb-2">Email ou téléphone</label>
                        <input type="text" class="w-full p-2 border rounded-lg">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2">Mot de passe</label>
                        <input type="password" class="w-full p-2 border rounded-lg">
                    </div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" class="mr-2"> Se souvenir de moi
                        </label>
                        <a href="#" class="text-blue-600 hover:underline">Mot de passe oublié?</a>
                    </div>
                    
                    <button type="submit" class="w-full py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition mb-4">
                        Se connecter
                    </button>
                    
                    <div class="text-center">
                        <p class="text-gray-600">Vous n'avez pas de compte? <a href="#" class="text-blue-600 hover:underline">S'inscrire</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Choix Méthode d'envoi -->
    <div id="sendMethodModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-2 sm:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md m-2 sm:m-4 modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-gradient-strong">Choisir la méthode d'envoi</h3>
                    <button id="closeSendMethodModal" class="text-gray-500 hover:text-gray-700 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <p class="text-gray-600 mb-6">Comment souhaitez-vous envoyer votre message ?</p>
                
                <div class="space-y-4">
                    <!-- Option WhatsApp -->
                    <button id="sendWhatsAppBtn" class="w-full p-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition transform hover:scale-105 flex items-center justify-center">
                        <i class="fab fa-whatsapp text-3xl mr-4"></i>
                        <div class="text-left">
                            <p class="font-bold text-lg">Envoyer par WhatsApp</p>
                            <p class="text-sm text-green-100">Message direct sur le 87 77 67 76</p>
                        </div>
                    </button>
                    
                    <!-- Option Email -->
                    <button id="sendEmailBtn" class="w-full p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg hover:from-blue-600 hover:to-blue-700 transition transform hover:scale-105 flex items-center justify-center">
                        <i class="fas fa-envelope text-3xl mr-4"></i>
                        <div class="text-left">
                            <p class="font-bold text-lg">Envoyer par Email</p>
                            <p class="text-sm text-blue-100">taxidreba@gmail.com</p>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Driver Login Modal -->
    <div id="driverLoginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-2 sm:p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gradient-strong">Connexion Chauffeur</h3>
                    <button id="closeDriverLoginModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="driverLoginForm">
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold">Numéro de téléphone <span class="text-red-500">*</span></label>
                        <div class="flex">
                            <div class="px-4 py-3 bg-green-50 border-2 border-r-0 border-gray-300 rounded-l-lg text-green-700 font-bold">
                                +227
                            </div>
                            <input type="tel" id="driverLoginPhone" required maxlength="8" pattern="[0-9]{8}" class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-r-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="12345678">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold">Code PIN <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <input type="password" id="driverLoginPin" required minlength="4" maxlength="6" pattern="[0-9]{4,6}" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 transition" placeholder="••••">
                            <button type="button" onclick="togglePinVisibility('driverLoginPin')" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-green-600">
                                <i class="fas fa-eye" id="driverLoginPinEyeIcon"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-4 bg-blue-50 p-3 rounded-lg border-l-4 border-blue-600">
                        <label class="flex items-start cursor-pointer">
                            <input type="checkbox" id="shareLocationCheckbox" class="mt-1 mr-2" checked>
                            <span class="text-sm text-gray-700">
                                Partager ma localisation en temps réel pour recevoir des courses
                            </span>
                        </label>
                    </div>
                    
                    <button type="submit" class="w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-700 hover:to-emerald-700 transition mb-4">
                        <i class="fas fa-sign-in-alt mr-2"></i>Se connecter
                    </button>
                    
                    <div class="text-center">
                        <p class="text-gray-600 text-sm">Vous n'avez pas encore de compte? <a href="#rental" class="text-green-600 hover:underline font-semibold">S'inscrire</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Diaporama aléatoire des photos de taxis
        const taxiImages = {
            simple: [
                'Photo Taxi/Taxi Simple (1).jpeg',
                'Photo Taxi/Taxi Simple (1).png',
                'Photo Taxi/Taxi Simple (3).jpeg',
                'Photo Taxi/Taxi Simple (4).jpeg',
                'Photo Taxi/Taxi Simple (5).jpeg',
                'Photo Taxi/Taxi Simple (6).jpeg',
                'Photo Taxi/Taxi Simple (7).jpeg'
            ],
            standard: [
                'Photo Taxi/Taxi Standard.jpeg',
                'Photo Taxi/Taxi Standard.png'
            ],
            vip: [
                'Photo Taxi/Taxi VIP (1).jpeg',
                'Photo Taxi/Taxi VIP (1).png',
                'Photo Taxi/Taxi VIP (2).jpeg',
                'Photo Taxi/Taxi VIP (2).png',
                'Photo Taxi/Taxi VIP (3).jpeg',
                'Photo Taxi/Taxi VIP (4).jpeg',
                'Photo Taxi/Taxi VIP (5).jpeg',
                'Photo Taxi/Taxi VIP (6).jpeg',
                'Photo Taxi/Taxi VIP (7).jpeg'
            ]
        };
        
        // Fonction pour obtenir une image aléatoire différente de la précédente
        function getRandomImage(images, currentIndex) {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * images.length);
            } while (images.length > 1 && newIndex === currentIndex);
            return { index: newIndex, src: images[newIndex] };
        }
        
        // Initialiser les diaporamas
        function initTaxiSliders() {
            const sliders = {
                'taxi-simple-slider': { images: taxiImages.simple, currentIndex: 0 },
                'taxi-standard-slider': { images: taxiImages.standard, currentIndex: 0 },
                'taxi-vip-slider': { images: taxiImages.vip, currentIndex: 0 }
            };
            
            Object.keys(sliders).forEach(sliderId => {
                const slider = document.getElementById(sliderId);
                if (!slider) return;
                
                const sliderData = sliders[sliderId];
                
                // Fonction pour changer l'image
                function changeImage() {
                    const { index, src } = getRandomImage(sliderData.images, sliderData.currentIndex);
                    
                    // Fade out
                    slider.classList.remove('fade-in');
                    slider.classList.add('fade-out');
                    
                    setTimeout(() => {
                        slider.src = src;
                        sliderData.currentIndex = index;
                        
                        // Fade in
                        slider.classList.remove('fade-out');
                        slider.classList.add('fade-in');
                    }, 400);
                }
                
                // Changer l'image toutes les 5 secondes
                setInterval(changeImage, 5000);
            });
        }
        
        // Initialiser les sliders quand le DOM est prêt
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initTaxiSliders);
        } else {
            initTaxiSliders();
        }
        
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        
        if (menuToggle && mobileMenu) {
            menuToggle.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
        }

        // Language dropdown toggle
        document.getElementById('languageBtn').addEventListener('click', function() {
            const dropdown = document.getElementById('languageDropdown');
            dropdown.classList.toggle('hidden');
        });

        // Dark mode toggle
        document.getElementById('darkModeToggle').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            const icon = this.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        });

        // Fonction globale pour scroller vers la réservation et pré-sélectionner le type de taxi
        window.scrollToBooking = function(taxiType) {
            const bookingSection = document.getElementById('booking');
            if (bookingSection) {
                bookingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Pré-sélectionner le type de taxi dans le formulaire
                setTimeout(function() {
                    const categorySelect = document.querySelector('#bookingForm select');
                    if (categorySelect) {
                        if (taxiType === 'simple') {
                            categorySelect.value = 'simple';
                        } else if (taxiType === 'standard') {
                            categorySelect.value = 'standard';
                        } else if (taxiType === 'vip') {
                            categorySelect.value = 'vip';
                        }
                        // Déclencher l'événement change pour mettre à jour l'interface
                        categorySelect.dispatchEvent(new Event('change'));
                        
                        // Ajouter un effet visuel pour indiquer la sélection
                        categorySelect.style.transform = 'scale(1.05)';
                        categorySelect.style.transition = 'transform 0.3s ease';
                        setTimeout(function() {
                            categorySelect.style.transform = 'scale(1)';
                        }, 300);
                    }
                }, 500);
            }
        };

        // Les calculateurs de prix ont été supprimés - facturation par trajet uniquement

        // Car category buttons
        const categoryBtns = document.querySelectorAll('.category-btn');
        categoryBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                categoryBtns.forEach(b => {
                    b.classList.remove('bg-blue-600', 'text-white');
                    b.classList.add('bg-blue-100', 'text-blue-600');
                });
                this.classList.remove('bg-blue-100', 'text-blue-600');
                this.classList.add('bg-blue-600', 'text-white');
                
                // Here you would filter cars by category
            });
        });

        // Carousel navigation (seulement si le carousel existe)
        const carouselTrack = document.getElementById('carouselTrack');
        const carouselItems = document.querySelectorAll('.carousel-item');
        const carouselPrev = document.querySelector('.carousel-prev');
        const carouselNext = document.querySelector('.carousel-next');
        
        if (carouselTrack && carouselItems.length > 0 && carouselPrev && carouselNext) {
        const itemWidth = carouselItems[0].offsetWidth;
        let currentPosition = 0;

            carouselPrev.addEventListener('click', function() {
            if (currentPosition < 0) {
                currentPosition += itemWidth;
                carouselTrack.style.transform = `translateX(${currentPosition}px)`;
            }
        });

            carouselNext.addEventListener('click', function() {
            const maxPosition = -itemWidth * (carouselItems.length - 1);
            if (currentPosition > maxPosition) {
                currentPosition -= itemWidth;
                carouselTrack.style.transform = `translateX(${currentPosition}px)`;
            }
        });
        }

        // Pagination verticale avec synchronisation améliorée
        const paginationItems = document.querySelectorAll('.pagination li');
        const sections = document.querySelectorAll('section[id]');
        
        if (paginationItems.length > 0 && sections.length > 0) {
            let isScrolling = false;
            
            // Fonction pour mettre à jour l'élément actif de la pagination
            function updateActivePagination() {
                if (isScrolling) return;
                
                const scrollPosition = window.scrollY + window.innerHeight / 3;
                let currentSection = null;
                let minDistance = Infinity;
                
                sections.forEach((section) => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    const sectionBottom = sectionTop + sectionHeight;
                    const sectionId = section.getAttribute('id');
                    
                    // Vérifier si la section est visible dans le viewport
                    if (scrollPosition >= sectionTop && scrollPosition <= sectionBottom) {
                        const distance = Math.abs(scrollPosition - (sectionTop + sectionHeight / 2));
                        if (distance < minDistance) {
                            minDistance = distance;
                            currentSection = sectionId;
                        }
                    }
                });
                
                // Si aucune section n'est trouvée, prendre la première visible
                if (!currentSection) {
                    sections.forEach((section) => {
                        const sectionTop = section.offsetTop;
                        const sectionBottom = sectionTop + section.offsetHeight;
                        if (window.scrollY >= sectionTop - 100 && window.scrollY < sectionBottom) {
                            currentSection = section.getAttribute('id');
                        }
                    });
                }
                
                // Mettre à jour les classes actives
                paginationItems.forEach(item => {
                    item.classList.remove('active');
                    const sectionId = item.getAttribute('data-section').substring(1);
                    if (sectionId === currentSection) {
                        item.classList.add('active');
                    }
                });
            }
            
            // Ajouter les écouteurs d'événements pour la pagination
            paginationItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    isScrolling = true;
                    
                    const targetSection = this.getAttribute('data-section');
                    const targetElement = document.querySelector(targetSection);
                    
                    if (targetElement) {
                        // Mettre à jour immédiatement la classe active
                        paginationItems.forEach(li => li.classList.remove('active'));
                        this.classList.add('active');
                        
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: 'smooth'
                        });
                        
                        // Réactiver la synchronisation après le scroll
                        setTimeout(() => {
                            isScrolling = false;
                            updateActivePagination();
                        }, 1000);
                    }
                });
            });
            
            // Mettre à jour la pagination lors du scroll avec debounce
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                if (scrollTimeout) {
                    clearTimeout(scrollTimeout);
                }
                scrollTimeout = setTimeout(updateActivePagination, 50);
            }, { passive: true });
            
            // Initialiser au chargement
            updateActivePagination();
            
            // Mettre à jour après le chargement complet
            window.addEventListener('load', updateActivePagination);
        }

        // Driver modal
        const driverModal = document.getElementById('driverModal');
        const closeDriverModal = document.getElementById('closeDriverModal');

        // ============================================
        // CONFIGURATION DE LA CARTE OPENSTREETMAP
        // ============================================
        // 
        // IMPORTANT: OpenStreetMap avec Leaflet est GRATUIT et ne nécessite PAS de clé API
        // pour l'utilisation de base. La carte fonctionne déjà sans configuration supplémentaire.
        //
        // Si vous voulez utiliser des services premium (Mapbox, Google Maps, etc.):
        // 1. Obtenez votre clé API sur le site du fournisseur
        // 2. Remplacez la section L.tileLayer ci-dessous (lignes ~1570-1580)
        // 3. Décommentez le code Mapbox et remplacez 'VOTRE_CLE_API_ICI' par votre clé
        //
        // Exemple pour Mapbox (déjà commenté dans le code):
        // L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=VOTRE_CLE_API_ICI', {
        //     accessToken: 'VOTRE_CLE_API_ICI'
        // }).addTo(map);
        //
        // ============================================
        
        let map;
        let vehicleMarkers = [];
        let pickupMarker = null;
        let destinationMarker = null;
        let routeLine = null; // Ligne entre départ et destination
        let isSelectingPickup = true; // true = sélection départ, false = sélection destination
        let currentWatchPosition = null;
        let geolocationPermission = null; // Stocker l'état de la permission
        let lastKnownPosition = null; // Stocker la dernière position connue
        
        function initMap() {
            // Vérifier que Leaflet est chargé
            if (typeof L === 'undefined') {
                console.error('Leaflet n\'est pas chargé. Vérifiez que les CDN sont bien inclus.');
                return;
            }
            
            // Vérifier que le conteneur existe
            const mapElement = document.getElementById('map');
            if (!mapElement) {
                console.error('L\'élément #map n\'existe pas');
                return;
            }
            
            // Vérifier que le conteneur a une taille
            if (mapElement.offsetHeight === 0 || mapElement.offsetWidth === 0) {
                console.warn('Le conteneur #map n\'a pas de taille, attente...');
                setTimeout(initMap, 300);
                return;
            }
            
            console.log('Initialisation de la carte...');
            
            // Coordonnées de Niamey, Niger (centre par défaut)
            const niameyCenter = [13.5127, 2.1108];
            
            // Initialiser la carte
            try {
                // Vérifier si la carte existe déjà
                if (map && map._container) {
                    console.log('La carte existe déjà, redimensionnement...');
                    map.invalidateSize();
                    return;
                }
                
                map = L.map('map', {
                    zoomControl: true,
                    scrollWheelZoom: true,
                    preferCanvas: false
                });
                
                console.log('Carte créée avec succès');
                
                // Ajouter les tuiles OpenStreetMap (gratuit, pas de clé API nécessaire)
                const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19,
                    tileSize: 256,
                    subdomains: ['a', 'b', 'c'],
                    crossOrigin: true,
                    errorTileUrl: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'
                });
                
                osmLayer.addTo(map);
                
                console.log('Tuiles ajoutées avec succès');
                
                // Ne pas centrer sur Niamey maintenant, attendre la géolocalisation
                // La vue sera définie par la géolocalisation ou Niamey en fallback
                
                // Forcer le redimensionnement de la carte
                setTimeout(function() {
                    if (map) {
                        map.invalidateSize();
                        console.log('Carte redimensionnée');
                    }
                }, 300);
                
                // Vérifier que les tuiles se chargent
                osmLayer.on('tileload', function() {
                    console.log('Tuile chargée avec succès');
                });
                
                osmLayer.on('tileerror', function(error, tile) {
                    console.error('Erreur de chargement de tuile:', error, tile);
                });
                
                // Initialiser les fonctionnalités de sélection
                initializeMapInteractions();
            } catch (error) {
                console.error('Erreur lors de la création de la carte:', error);
                mapElement.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; flex-direction: column;"><i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 10px; color: #f59e0b;"></i><p>Erreur de chargement de la carte</p><p style="font-size: 12px; margin-top: 10px;">' + error.message + '</p></div>';
                return;
            }
            
            // OPTIONNEL: Si vous voulez utiliser Mapbox ou d'autres services premium,
            // décommentez et remplacez par votre clé API :
            /*
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=VOTRE_CLE_API_ICI', {
                attribution: '© Mapbox',
                id: 'mapbox/streets-v11',
                tileSize: 512,
                zoomOffset: -1,
                accessToken: 'VOTRE_CLE_API_ICI'
            }).addTo(map);
            */
            
            // Obtenir la position de l'utilisateur et centrer la carte dessus
            // Ne demander la géolocalisation qu'une seule fois au chargement
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        const accuracy = position.coords.accuracy;
                        
                        // Centrer la carte sur la position de l'utilisateur avec zoom adapté
                        const zoomLevel = accuracy < 10 ? 18 : accuracy < 50 ? 17 : 16;
                        map.setView([lat, lng], zoomLevel);
                        
                        // Définir automatiquement comme point de départ
                        setPickupLocation(lat, lng, accuracy);
                        isSelectingPickup = false; // Prochaine fois, ce sera la destination
                        updateAccuracyIndicator(accuracy);
                    },
                    function(error) {
                        // En cas d'erreur, centrer sur Niamey par défaut
                        console.log('Géolocalisation non disponible, utilisation de la position par défaut');
                        map.setView(niameyCenter, 13);
                    },
                    {
                        enableHighAccuracy: true, // Meilleure précision
                        timeout: 15000, // Timeout plus long pour laisser le GPS se stabiliser
                        maximumAge: 30000 // Utiliser une position récente (30 secondes max)
                    }
                );
            }
            
            // Redimensionner la carte une dernière fois après tout
            setTimeout(function() {
                if (map) {
                    map.invalidateSize();
                }
            }, 500);
        }
        
        // ============================================
        // FONCTIONS DE GESTION DE LA CARTE INTERACTIVE
        // ============================================
        
        // Initialiser les interactions de la carte
        function initializeMapInteractions() {
            if (!map) return;
            
            // Gérer les clics sur la carte
            map.on('click', function(e) {
                const lat = e.latlng.lat;
                const lng = e.latlng.lng;
                
                // Si aucun point de départ n'est défini, définir le départ
                if (!pickupMarker) {
                    setPickupLocation(lat, lng);
                    isSelectingPickup = false; // Prochaine fois, ce sera la destination
                }
                // Si le départ est défini mais pas la destination, définir la destination
                else if (!destinationMarker) {
                    setDestinationLocation(lat, lng);
                    isSelectingPickup = true; // Réinitialiser pour permettre de changer le départ
                }
                // Si les deux sont définis, remplacer le point de départ
                else {
                    setPickupLocation(lat, lng);
                    isSelectingPickup = false; // Prochaine fois, ce sera la destination
                }
            });
            
            // Bouton utiliser ma position - Version améliorée pour meilleure précision
            const useMyLocationBtn = document.getElementById('useMyLocationBtn');
            if (useMyLocationBtn) {
                useMyLocationBtn.addEventListener('click', function() {
                    if (!navigator.geolocation) {
                        alert('La géolocalisation n\'est pas supportée par votre navigateur.');
                        return;
                    }
                    
                    // Désactiver le bouton pendant la récupération
                    const btn = this;
                    const originalContent = btn.innerHTML;
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i><span class="hidden md:inline">Localisation...</span>';
                    
                    // Options pour obtenir la meilleure précision possible
                    const geoOptions = {
                        enableHighAccuracy: true, // Demander la meilleure précision GPS
                        timeout: 15000, // Timeout de 15 secondes pour laisser le temps au GPS
                        maximumAge: 0 // Ne pas utiliser de position en cache
                    };
                    
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            const accuracy = position.coords.accuracy;
                            
                            // Définir la position de départ
                            setPickupLocation(lat, lng, accuracy);
                            
                            // Réinitialiser pour que le prochain clic soit la destination
                            isSelectingPickup = false;
                            
                            // Centrer la carte avec un zoom adapté selon la précision
                            const zoomLevel = accuracy < 10 ? 18 : accuracy < 50 ? 17 : 16;
                            map.setView([lat, lng], zoomLevel);
                            
                            // Afficher la précision
                            updateAccuracyIndicator(accuracy);
                            
                            // Réactiver le bouton
                            btn.disabled = false;
                            btn.innerHTML = originalContent;
                            
                            // Message informatif si la précision est bonne
                            if (accuracy <= 20) {
                                console.log(`Position obtenue avec une précision de ${accuracy.toFixed(1)} mètres`);
                            }
                        },
                        function(error) {
                            // Réactiver le bouton
                            btn.disabled = false;
                            btn.innerHTML = originalContent;
                            
                            let errorMessage = 'Impossible d\'obtenir votre position. ';
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMessage += 'Veuillez autoriser l\'accès à la géolocalisation dans les paramètres de votre navigateur.';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMessage += 'Votre position n\'a pas pu être déterminée.';
                                    break;
                                case error.TIMEOUT:
                                    errorMessage += 'Le délai d\'attente a été dépassé. Veuillez réessayer.';
                                    break;
                                default:
                                    errorMessage += 'Une erreur inconnue s\'est produite.';
                                    break;
                            }
                            alert(errorMessage);
                        },
                        geoOptions
                    );
                });
            }
            
            // Bouton effacer
            const clearBtn = document.getElementById('clearMarkersBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    clearMarkers();
                });
            }
            
            // Gérer la saisie d'adresse pour le point de départ
            const pickupInput = document.getElementById('pickupAddressInput');
            if (pickupInput) {
                let pickupInputTimeout;
                pickupInput.addEventListener('input', function() {
                    clearTimeout(pickupInputTimeout);
                    const address = this.value.trim();
                    
                    // Attendre 1 seconde après la fin de la saisie avant de géocoder
                    pickupInputTimeout = setTimeout(function() {
                        if (address && address.length > 3) {
                            geocodeAddress(address, function(lat, lng) {
                                if (lat && lng) {
                                    setPickupLocation(lat, lng);
                                    map.setView([lat, lng], 16);
                                    isSelectingPickup = false; // Prochaine fois, ce sera la destination
                                } else {
                                    // Si le géocodage échoue, essayer de parser les coordonnées
                                    const coordMatch = address.match(/(-?\d+\.?\d*),\s*(-?\d+\.?\d*)/);
                                    if (coordMatch) {
                                        const lat = parseFloat(coordMatch[1]);
                                        const lng = parseFloat(coordMatch[2]);
                                        if (!isNaN(lat) && !isNaN(lng)) {
                                            setPickupLocation(lat, lng);
                                            map.setView([lat, lng], 16);
                                            isSelectingPickup = false;
                                        }
                                    }
                                }
                            });
                        }
                    }, 1000);
                });
            }
            
            // Gérer la saisie d'adresse pour la destination
            const destinationInput = document.getElementById('destinationAddressInput');
            if (destinationInput) {
                let destinationInputTimeout;
                destinationInput.addEventListener('input', function() {
                    clearTimeout(destinationInputTimeout);
                    const address = this.value.trim();
                    
                    // Attendre 1 seconde après la fin de la saisie avant de géocoder
                    destinationInputTimeout = setTimeout(function() {
                        if (address && address.length > 3) {
                            geocodeAddress(address, function(lat, lng) {
                                if (lat && lng) {
                                    setDestinationLocation(lat, lng);
                                    map.setView([lat, lng], 16);
                                    isSelectingPickup = true; // Réinitialiser pour permettre de changer le départ
                                } else {
                                    // Si le géocodage échoue, essayer de parser les coordonnées
                                    const coordMatch = address.match(/(-?\d+\.?\d*),\s*(-?\d+\.?\d*)/);
                                    if (coordMatch) {
                                        const lat = parseFloat(coordMatch[1]);
                                        const lng = parseFloat(coordMatch[2]);
                                        if (!isNaN(lat) && !isNaN(lng)) {
                                            setDestinationLocation(lat, lng);
                                            map.setView([lat, lng], 16);
                                            isSelectingPickup = true;
                                        }
                                    }
                                }
                            });
                        }
                    }, 1000);
                });
            }
            
        }
        
        // Définir le point de départ
        function setPickupLocation(lat, lng, accuracy = null) {
            // Supprimer l'ancien marqueur
            if (pickupMarker) {
                map.removeLayer(pickupMarker);
            }
            
            // Créer un nouveau marqueur pour le départ
            const pickupIcon = L.divIcon({
                className: 'custom-pickup-marker',
                html: `<div style="background: #10b981; width: 32px; height: 32px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-map-marker-alt" style="color: white; font-size: 16px;"></i>
                </div>`,
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });
            
            pickupMarker = L.marker([lat, lng], { icon: pickupIcon, draggable: true })
                .addTo(map)
                .bindPopup('<strong>Point de départ</strong><br>Glissez pour ajuster')
                .openPopup();
            
            // Permettre de déplacer le marqueur
            pickupMarker.on('dragend', function(e) {
                const pos = e.target.getLatLng();
                updatePickupInput(pos.lat, pos.lng);
                // Recalculer la ligne si la destination existe
                if (destinationMarker) {
                    drawRouteLine();
                }
            });
            
            // Mettre à jour les champs du formulaire
            updatePickupInput(lat, lng, accuracy);
            
            // Dessiner la ligne si la destination existe déjà
            if (destinationMarker) {
                drawRouteLine();
            }
        }
        
        // Définir la destination
        function setDestinationLocation(lat, lng) {
            // Supprimer l'ancien marqueur
            if (destinationMarker) {
                map.removeLayer(destinationMarker);
            }
            
            // Créer un nouveau marqueur pour la destination
            const destinationIcon = L.divIcon({
                className: 'custom-destination-marker',
                html: `<div style="background: #ef4444; width: 32px; height: 32px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-flag-checkered" style="color: white; font-size: 16px;"></i>
                </div>`,
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            });
            
            destinationMarker = L.marker([lat, lng], { icon: destinationIcon, draggable: true })
                .addTo(map)
                .bindPopup('<strong>Destination</strong><br>Glissez pour ajuster')
                .openPopup();
            
            // Permettre de déplacer le marqueur
            destinationMarker.on('dragend', function(e) {
                const pos = e.target.getLatLng();
                updateDestinationInput(pos.lat, pos.lng);
                // Recalculer la ligne si le départ existe
                if (pickupMarker) {
                    drawRouteLine();
                }
            });
            
            // Mettre à jour les champs du formulaire
            updateDestinationInput(lat, lng);
            
            // Dessiner la ligne si le départ existe déjà
            if (pickupMarker) {
                drawRouteLine();
            }
        }
        
        // Calculer la distance entre deux points (formule de Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Dessiner la ligne entre départ et destination et calculer la distance
        function drawRouteLine() {
            if (!pickupMarker || !destinationMarker) return;
            
            const pickupLatLng = pickupMarker.getLatLng();
            const destLatLng = destinationMarker.getLatLng();
            
            // Supprimer l'ancienne ligne si elle existe
            if (routeLine) {
                map.removeLayer(routeLine);
            }
            
            // Dessiner la nouvelle ligne
            routeLine = L.polyline(
                [[pickupLatLng.lat, pickupLatLng.lng], [destLatLng.lat, destLatLng.lng]],
                {
                    color: '#10b981',
                    weight: 4,
                    opacity: 0.7,
                    dashArray: '10, 10'
                }
            ).addTo(map);
            
            // Calculer la distance
            const distance = calculateDistance(
                pickupLatLng.lat, pickupLatLng.lng,
                destLatLng.lat, destLatLng.lng
            );
            
            // Afficher la distance dans les coordonnées de destination
            const destCoords = document.getElementById('destinationCoords');
            if (destCoords) {
                destCoords.textContent = `${destLatLng.lat.toFixed(6)}, ${destLatLng.lng.toFixed(6)} - Distance: ${distance.toFixed(2)} km`;
            }
            
            // Ajuster la vue pour voir les deux points
            const group = new L.featureGroup([pickupMarker, destinationMarker]);
            map.fitBounds(group.getBounds().pad(0.1));
        }
        
        
        // Mettre à jour l'indicateur de précision
        function updateAccuracyIndicator(accuracy) {
            const indicator = document.getElementById('accuracyIndicator');
            const value = document.getElementById('accuracyValue');
            
            if (indicator && value) {
                indicator.classList.remove('hidden');
                value.textContent = accuracy ? `${accuracy.toFixed(1)} m` : '-';
                
                // Changer la couleur selon la précision
                if (accuracy <= 3) {
                    value.className = 'font-semibold text-green-600';
                } else if (accuracy <= 10) {
                    value.className = 'font-semibold text-yellow-600';
                } else {
                    value.className = 'font-semibold text-red-600';
                }
            }
        }
        
        // Mettre à jour le champ de départ
        function updatePickupInput(lat, lng, accuracy = null) {
            const input = document.getElementById('pickupAddressInput');
            const coords = document.getElementById('pickupCoords');
            
            if (coords) {
                let text = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                if (accuracy) {
                    text += ` (Précision: ${accuracy.toFixed(1)}m)`;
                }
                coords.textContent = text;
            }
            
            // Faire un reverse geocoding pour obtenir l'adresse
            if (input) {
                geocodeReverse(lat, lng, function(address) {
                    if (input && address) {
                        input.value = address;
                    } else if (input) {
                        input.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    }
                });
            }
        }
        
        // Mettre à jour le champ de destination
        function updateDestinationInput(lat, lng) {
            const input = document.getElementById('destinationAddressInput');
            const coords = document.getElementById('destinationCoords');
            
            // Si le départ existe, calculer et afficher la distance
            if (pickupMarker && coords) {
                const pickupLatLng = pickupMarker.getLatLng();
                const distance = calculateDistance(
                    pickupLatLng.lat, pickupLatLng.lng,
                    lat, lng
                );
                coords.textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)} - Distance: ${distance.toFixed(2)} km`;
            } else if (coords) {
                coords.textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            }
            
            // Faire un reverse geocoding pour obtenir l'adresse
            if (input) {
                geocodeReverse(lat, lng, function(address) {
                    if (input && address) {
                        input.value = address;
                    } else if (input) {
                        input.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
                    }
                });
            }
        }
        
        // Reverse geocoding (coordonnées -> adresse) avec Nominatim
        function geocodeReverse(lat, lng, callback) {
            const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`;
            
            fetch(url, {
                headers: {
                    'User-Agent': 'DrebaVTC/1.0'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data && data.display_name) {
                    callback(data.display_name);
                } else {
                    callback(null);
                }
            })
            .catch(error => {
                console.log('Erreur de géocodage inverse:', error);
                callback(null);
            });
        }
        
        // Géocodage (adresse -> coordonnées) avec Nominatim
        function geocodeAddress(address, callback) {
            if (!address || address.trim() === '') {
                callback(null, null);
                return;
            }
            
            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1&addressdetails=1`;
            
            fetch(url, {
                headers: {
                    'User-Agent': 'DrebaVTC/1.0'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data && data.length > 0) {
                    const lat = parseFloat(data[0].lat);
                    const lng = parseFloat(data[0].lon);
                    callback(lat, lng);
                } else {
                    callback(null, null);
                }
            })
            .catch(error => {
                console.log('Erreur de géocodage:', error);
                callback(null, null);
            });
        }
        
        
        // Effacer tous les marqueurs
        function clearMarkers() {
            if (pickupMarker) {
                map.removeLayer(pickupMarker);
                pickupMarker = null;
            }
            if (destinationMarker) {
                map.removeLayer(destinationMarker);
                destinationMarker = null;
            }
            if (routeLine) {
                map.removeLayer(routeLine);
                routeLine = null;
            }
            // Réinitialiser les champs
            const pickupInput = document.getElementById('pickupAddressInput');
            const destInput = document.getElementById('destinationAddressInput');
            const pickupCoords = document.getElementById('pickupCoords');
            const destCoords = document.getElementById('destinationCoords');
            
            if (pickupInput) pickupInput.value = '';
            if (destInput) destInput.value = '';
            if (pickupCoords) pickupCoords.textContent = 'Non défini';
            if (destCoords) destCoords.textContent = 'Non défini';
            
            // Réinitialiser pour que le prochain clic soit le départ
            isSelectingPickup = true;
        }
        
        // Fonction pour ajouter des marqueurs de véhicules (appelée depuis votre API)
        function addVehicleMarkers() {
            // Cette fonction sera appelée avec les données réelles de votre API
            // Pour l'instant, elle est vide - vous devrez la remplir avec vos données réelles
            
            // Exemple d'utilisation avec votre API :
            /*
            fetch('VOTRE_API_ENDPOINT/vehicles')
                .then(response => response.json())
                .then(vehicles => {
                    vehicles.forEach(vehicle => {
                        const isAvailable = vehicle.status === 'available';
                        const iconColor = isAvailable ? '#10b981' : '#f59e0b';
                        const iconClass = 'fa-taxi';
                        
                        const customIcon = L.divIcon({
                            className: 'custom-marker ' + (isAvailable ? 'marker-available' : 'marker-reserved'),
                            html: `<div style="background: ${iconColor}; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                <i class="fas ${iconClass}"></i>
                            </div>`,
                            iconSize: [40, 40],
                            iconAnchor: [20, 20]
                        });
                        
                        const marker = L.marker([vehicle.lat, vehicle.lng], { icon: customIcon })
                            .addTo(map)
                            .bindPopup(`
                                <div style="text-align: center;">
                                    <strong>${vehicle.type || 'Taxi'}</strong><br>
                                    Conducteur: ${vehicle.driver || 'N/A'}<br>
                                    Statut: ${isAvailable ? '<span style="color: green;">Disponible</span>' : '<span style="color: orange;">Réservé</span>'}
                                </div>
                            `);
                        
                        vehicleMarkers.push(marker);
                    });
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des véhicules:', error);
                });
            */
        }
        
        // Initialiser la carte quand la page est chargée
        // Cette fonction sera appelée après le chargement de Leaflet
        window.initializeMap = function() {
            // Attendre que Leaflet soit chargé
            if (typeof L === 'undefined') {
                setTimeout(window.initializeMap, 200);
                return;
            }
            
            // Attendre que le conteneur existe et soit visible
            const mapElement = document.getElementById('map');
            if (!mapElement) {
                setTimeout(window.initializeMap, 200);
                return;
            }
            
            // Vérifier que le conteneur a une taille
            if (mapElement.offsetHeight === 0 && mapElement.offsetWidth === 0) {
                setTimeout(window.initializeMap, 200);
                return;
            }
            
            // Vérifier si la carte est déjà initialisée
            if (typeof map !== 'undefined' && map && map._container) {
                map.invalidateSize();
                return;
            }
            
            // Initialiser la carte
            try {
                initMap();
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de la carte:', error);
                setTimeout(window.initializeMap, 500);
            }
        };
        
        // Réinitialiser la carte lors du redimensionnement de la fenêtre
        window.addEventListener('resize', function() {
            if (map) {
                setTimeout(function() {
                    map.invalidateSize();
                }, 100);
            }
        });

        // ============================================
        // Driver Registration Form Management
        // ============================================
        
        // Toggle PIN visibility
        function togglePinVisibility(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = document.getElementById(fieldId + 'EyeIcon');
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Show/hide color field based on service type
        const serviceTypeSelect = document.getElementById('serviceType');
        const colorField = document.getElementById('colorField');
        const vehicleColorInput = document.getElementById('vehicleColor');
        
        if (serviceTypeSelect) {
            serviceTypeSelect.addEventListener('change', function() {
                if (this.value !== 'simple') {
                    colorField.classList.remove('hidden');
                    vehicleColorInput.setAttribute('required', 'required');
                } else {
                    colorField.classList.add('hidden');
                    vehicleColorInput.removeAttribute('required');
                    vehicleColorInput.value = '';
                }
            });
        }
        
        // Reset form
        function resetForm() {
            const form = document.getElementById('driverRegistrationForm');
            if (form) {
                form.reset();
                colorField.classList.add('hidden');
                vehicleColorInput.removeAttribute('required');
            }
        }
        
        // Form submission handler
        const driverForm = document.getElementById('driverRegistrationForm');
        if (driverForm) {
            driverForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitBtn = document.getElementById('submitBtn');
                const submitText = document.getElementById('submitText');
                const submitLoader = document.getElementById('submitLoader');
                
                // Validate form
                if (!this.checkValidity()) {
                    this.reportValidity();
                    return;
                }
                
                // Validate PIN match
                const pin = document.getElementById('pin').value;
                const confirmPin = document.getElementById('confirmPin').value;
                if (pin !== confirmPin) {
                    alert('Les codes PIN ne correspondent pas.');
                    return;
                }
                
                // Validate phone number
                const phone = document.getElementById('phone').value;
                if (phone.length !== 8 || !/^\d{8}$/.test(phone)) {
                    alert('Veuillez entrer un numéro nigérien valide (8 chiffres).');
                    return;
                }
                
                // Show loading state
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                submitLoader.classList.remove('hidden');
                
                // Collect form data
                const formData = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim() || null,
                    phone: '+227' + phone,
                    license: document.getElementById('license').value.trim(),
                    plate: document.getElementById('plate').value.trim(),
                    serviceType: serviceTypeSelect.value.toUpperCase(),
                    vehicleBrand: document.getElementById('vehicleBrand').value.trim(),
                    vehicleColor: vehicleColorInput.value.trim() || null,
                    pin: pin
                };
                
                // Here you would send the data to your backend API
                // For now, we'll just show a success message
                setTimeout(() => {
                    alert('Inscription réussie ! Bienvenue chez Dréba VTC !\n\nVos informations ont été enregistrées. Vous recevrez un SMS de confirmation sous peu.');
                    resetForm();
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    submitLoader.classList.add('hidden');
                }, 1500);
                
                // TODO: Replace with actual API call
                /*
                try {
                    const response = await fetch('YOUR_API_ENDPOINT/drivers/register', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        alert('Inscription réussie ! Bienvenue chez Dréba VTC !');
                        resetForm();
                    } else {
                        const error = await response.json();
                        alert('Erreur: ' + (error.message || 'Une erreur est survenue'));
                    }
                } catch (error) {
                    alert('Erreur de connexion. Veuillez réessayer plus tard.');
                    console.error('Registration error:', error);
                } finally {
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    submitLoader.classList.add('hidden');
                }
                */
            });
        }
        
        // Phone number input validation (numbers only, max 8 digits)
        const phoneInput = document.getElementById('phone');
        if (phoneInput) {
            phoneInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '').slice(0, 8);
            });
        }
        
        // PIN inputs validation (numbers only)
        ['pin', 'confirmPin'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', function(e) {
                    this.value = this.value.replace(/\D/g, '').slice(0, 6);
                });
            }
        });

        // ============================================
        // Système d'appel et gestion des chauffeurs
        // ============================================

        // Bouton d'appel fixe avec tooltip
        const callButton = document.getElementById('callButton');
        const callTooltip = document.getElementById('callTooltip');
        
        if (callButton && callTooltip) {
            callButton.addEventListener('mouseenter', () => {
                callTooltip.classList.remove('hidden');
            });
            callButton.addEventListener('mouseleave', () => {
                callTooltip.classList.add('hidden');
            });
        }

        // Modal Conditions d'utilisation
        const termsModal = document.getElementById('termsModal');
        const closeTermsModal = document.getElementById('closeTermsModal');
        const viewTermsBtn = document.getElementById('viewTermsBtn');
        const acceptTermsCheckbox = document.getElementById('acceptTermsCheckbox');
        const acceptTermsBtn = document.getElementById('acceptTermsBtn');
        const cancelTermsBtn = document.getElementById('cancelTermsBtn');
        const acceptTermsInModal = document.getElementById('acceptTerms');

        if (viewTermsBtn && termsModal) {
            viewTermsBtn.addEventListener('click', () => {
                termsModal.classList.remove('hidden');
            });
        }

        if (closeTermsModal) {
            closeTermsModal.addEventListener('click', () => {
                termsModal.classList.add('hidden');
            });
        }

        if (cancelTermsBtn) {
            cancelTermsBtn.addEventListener('click', () => {
                termsModal.classList.add('hidden');
            });
        }

        // Activer le bouton d'acceptation dans la modal
        if (acceptTermsInModal) {
            acceptTermsInModal.addEventListener('change', function() {
                if (acceptTermsBtn) {
                    acceptTermsBtn.disabled = !this.checked;
                }
            });
        }

        // Accepter les conditions depuis la modal
        if (acceptTermsBtn) {
            acceptTermsBtn.addEventListener('click', () => {
                if (acceptTermsInModal && acceptTermsInModal.checked) {
                    acceptTermsCheckbox.checked = true;
                    termsModal.classList.add('hidden');
                }
            });
        }

        // L'ID est maintenant généré côté serveur

        // Modifier le formulaire d'inscription pour inclure la génération d'ID
        if (driverForm) {
            const originalSubmit = driverForm.onsubmit;
            driverForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Vérifier l'acceptation des conditions
                if (!acceptTermsCheckbox || !acceptTermsCheckbox.checked) {
                    alert('Veuillez accepter les conditions d\'utilisation pour continuer.');
                    viewTermsBtn?.click();
                    return;
                }

                const submitBtn = document.getElementById('submitBtn');
                const submitText = document.getElementById('submitText');
                const submitLoader = document.getElementById('submitLoader');
                
                // Validate form
                if (!this.checkValidity()) {
                    this.reportValidity();
                    return;
                }
                
                // Validate PIN match
                const pin = document.getElementById('pin').value;
                const confirmPin = document.getElementById('confirmPin').value;
                if (pin !== confirmPin) {
                    alert('Les codes PIN ne correspondent pas.');
                    return;
                }
                
                // Validate phone number
                const phone = document.getElementById('phone').value;
                if (phone.length !== 8 || !/^\d{8}$/.test(phone)) {
                    alert('Veuillez entrer un numéro nigérien valide (8 chiffres).');
                    return;
                }
                
                // Show loading state
                submitBtn.disabled = true;
                submitText.classList.add('hidden');
                submitLoader.classList.remove('hidden');
                
                // Collect form data
                const formData = {
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim() || null,
                    phone: phone, // Envoyer sans le +227, le backend le gère
                    license: document.getElementById('license').value.trim(),
                    plate: document.getElementById('plate').value.trim(),
                    serviceType: serviceTypeSelect.value,
                    vehicleBrand: document.getElementById('vehicleBrand').value.trim(),
                    vehicleColor: vehicleColorInput.value.trim() || null,
                    pin: pin,
                    locationSharingAccepted: acceptTermsCheckbox.checked
                };
                
                // Envoyer à Firebase
                try {
                    // Générer un ID unique pour le chauffeur
                    const driverId = generateDriverId();
                    
                    // Préparer les données pour Firebase
                    const driverData = {
                        driverId: driverId,
                        firstName: formData.firstName,
                        lastName: formData.lastName,
                        email: formData.email || null,
                        phone: formData.phone,
                        license: formData.license,
                        plate: formData.plate.toUpperCase(),
                        serviceType: formData.serviceType,
                        vehicleBrand: formData.vehicleBrand,
                        vehicleColor: formData.vehicleColor || null,
                        pin: formData.pin, // ⚠️ En production, hash ce mot de passe !
                        locationSharingAccepted: formData.locationSharingAccepted,
                        status: 'pending', // pending, approved, active, inactive
                        createdAt: getCurrentTimestamp(),
                        updatedAt: getCurrentTimestamp()
                    };
                    
                    // Vérifier si le numéro de téléphone existe déjà
                    const existingDriver = await db.collection('drivers')
                        .where('phone', '==', formData.phone)
                        .get();
                    
                    if (!existingDriver.empty) {
                        alert('Ce numéro de téléphone est déjà enregistré. Veuillez utiliser un autre numéro ou vous connecter.');
                        submitBtn.disabled = false;
                        submitText.classList.remove('hidden');
                        submitLoader.classList.add('hidden');
                        return;
                    }
                    
                    // Ajouter le chauffeur dans Firestore
                    await db.collection('drivers').doc(driverId).set(driverData);
                    
                    console.log('✅ Chauffeur enregistré dans Firebase:', driverId);
                    
                    alert(`Inscription réussie ! Bienvenue chez Dréba VTC !\n\nVotre ID chauffeur : ${driverId}\n\nVous pouvez maintenant vous connecter avec votre numéro de téléphone (+227${phone}) et votre code PIN.`);
                    resetForm();
                } catch (error) {
                    console.error('❌ Erreur:', error);
                    alert('Erreur lors de l\'inscription. Veuillez réessayer plus tard.\n\nErreur: ' + error.message);
                } finally {
                    // Reset button state
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    submitLoader.classList.add('hidden');
                }
            });
        }

        // ============================================
        // Panneau Admin
        // ============================================
        let adminMap = null;
        let adminMarkers = [];
        const adminModal = document.getElementById('adminModal');
        const adminBtn = document.getElementById('adminBtn');
        const closeAdminModal = document.getElementById('closeAdminModal');

        // Ouvrir le panneau admin
        if (adminBtn && adminModal) {
            adminBtn.addEventListener('click', () => {
                // Demander mot de passe admin (simulation)
                const password = prompt('Entrez le mot de passe admin:');
                if (password === 'admin123' || password === 'dreba2024') { // Mot de passe par défaut
                    adminModal.classList.remove('hidden');
                    initializeAdminPanel();
                } else if (password !== null) {
                    alert('Mot de passe incorrect.');
                }
            });
        }

        // Fermer le panneau admin
        if (closeAdminModal) {
            closeAdminModal.addEventListener('click', () => {
                adminModal.classList.add('hidden');
            });
        }

        // Initialiser le panneau admin
        function initializeAdminPanel() {
            // Initialiser la carte admin
            if (typeof L !== 'undefined') {
                const adminMapElement = document.getElementById('adminMap');
                if (adminMapElement && !adminMap) {
                    adminMap = L.map('adminMap').setView([13.5127, 2.1124], 12); // Niamey
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(adminMap);
                }
            }

            // Charger les chauffeurs
            loadDriversForAdmin();
            
            // Recherche de chauffeurs
            const driverSearch = document.getElementById('driverSearch');
            if (driverSearch) {
                driverSearch.addEventListener('input', (e) => {
                    filterDrivers(e.target.value);
                });
            }

            // Assigner un chauffeur
            const assignDriverBtn = document.getElementById('assignDriverBtn');
            if (assignDriverBtn) {
                assignDriverBtn.addEventListener('click', findNearestDriver);
            }

            // Gestion des périodes de statistiques
            const statsPeriodDay = document.getElementById('statsPeriodDay');
            const statsPeriodMonth = document.getElementById('statsPeriodMonth');
            const statsPeriodYear = document.getElementById('statsPeriodYear');
            
            if (statsPeriodDay) {
                statsPeriodDay.addEventListener('click', () => {
                    setActivePeriod('day');
                    loadAdminStats('day');
                });
            }
            if (statsPeriodMonth) {
                statsPeriodMonth.addEventListener('click', () => {
                    setActivePeriod('month');
                    loadAdminStats('month');
                });
            }
            if (statsPeriodYear) {
                statsPeriodYear.addEventListener('click', () => {
                    setActivePeriod('year');
                    loadAdminStats('year');
                });
            }

            // Mettre à jour les localisations en temps réel via Firestore
            // Écouter les changements de localisation en temps réel
            let realTimeListener = null;
            
            // Démarrer l'écoute en temps réel
            function startRealTimeTracking() {
                // Arrêter l'ancien listener s'il existe
                if (realTimeListener) {
                    realTimeListener();
                }
                
                realTimeListener = db.collection('drivers')
                    .where('isOnline', '==', true)
                    .onSnapshot((snapshot) => {
                        console.log('🔄 Mise à jour temps réel:', snapshot.docChanges().length, 'changements');
                        
                        snapshot.docChanges().forEach((change) => {
                            const driverData = change.doc.data();
                            const driverId = change.doc.id;
                            
                            if (change.type === 'added') {
                                // Nouveau chauffeur connecté
                                console.log('✅ Nouveau chauffeur connecté:', driverId);
                                if (driverData.location) {
                                    addDriverMarkerToAdminMap({
                                        driverId: driverId,
                                        ...driverData,
                                        isActive: true
                                    });
                                }
                            } else if (change.type === 'modified') {
                                // Mise à jour de localisation ou statut
                                if (driverData.location) {
                                    updateDriverLocationOnMap({
                                        driverId: driverId,
                                        location: driverData.location,
                                        driverData: driverData
                                    });
                                } else if (!driverData.isOnline) {
                                    // Chauffeur déconnecté
                                    removeDriverMarkerFromMap(driverId);
                                }
                            } else if (change.type === 'removed') {
                                // Chauffeur supprimé ou déconnecté
                                console.log('❌ Chauffeur déconnecté:', driverId);
                                removeDriverMarkerFromMap(driverId);
                            }
                        });
                    }, (error) => {
                        console.error('❌ Erreur suivi temps réel:', error);
                    });
            }
            
            // Démarrer le suivi en temps réel
            startRealTimeTracking();
            
            // Mettre à jour l'indicateur de statut
            const realtimeStatus = document.getElementById('realtimeStatus');
            if (realtimeStatus) {
                realtimeStatus.innerHTML = `
                    <span class="inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    <span class="text-xs text-green-600 font-semibold">Suivi temps réel actif</span>
                `;
            }

            // Rafraîchir les données toutes les 30 secondes
            setInterval(() => {
                loadDriversForAdmin();
                const activePeriod = document.querySelector('.stats-period-btn.active')?.id.replace('statsPeriod', '').toLowerCase() || 'day';
                loadAdminStats(activePeriod);
            }, 30000);
        }

        // Charger les statistiques admin avec période
        async function loadAdminStats(period = 'day') {
            try {
                // Calculer la date de début selon la période
                const now = new Date();
                let startDate = new Date();
                
                switch(period) {
                    case 'day':
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                    case 'year':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        break;
                }
                
                // Compter les chauffeurs actifs
                const activeDriversSnapshot = await db.collection('drivers')
                    .where('isOnline', '==', true)
                    .get();
                const activeDriversCount = activeDriversSnapshot.size;
                
                // Compter tous les chauffeurs
                const totalDriversSnapshot = await db.collection('drivers').get();
                const totalDriversCount = totalDriversSnapshot.size;
                
                // Compter les appels selon la période
                // Note: Pour une requête par date, on récupère tout et on filtre côté client
                // ou on utilise un champ date séparé
                const allCallsSnapshot = await db.collection('calls').get();
                let callsCount = 0;
                allCallsSnapshot.forEach(doc => {
                    const callData = doc.data();
                    const callDate = callData.timestamp?.toDate ? callData.timestamp.toDate() : 
                                   (callData.date ? new Date(callData.date) : new Date());
                    if (callDate >= startDate) {
                        callsCount++;
                    }
                });
                
                // Compter les réservations selon la période
                const allBookingsSnapshot = await db.collection('bookings').get();
                let reservationsCount = 0;
                allBookingsSnapshot.forEach(doc => {
                    const bookingData = doc.data();
                    const bookingDate = bookingData.createdAt?.toDate ? bookingData.createdAt.toDate() : 
                                       (bookingData.date ? new Date(bookingData.date) : new Date());
                    if (bookingDate >= startDate) {
                        reservationsCount++;
                    }
                });
                
                // Calculer le taux de conversion
                const rate = callsCount > 0 ? ((reservationsCount / callsCount) * 100).toFixed(1) : 0;
                
                // Mettre à jour les compteurs principaux
                const activeDriversEl = document.getElementById('activeDriversCount');
                const totalDriversEl = document.getElementById('totalDriversCount');
                const totalUsersEl = document.getElementById('totalUsersCount');
                const todayReservationsEl = document.getElementById('todayReservationsCount');
                
                if (activeDriversEl) activeDriversEl.textContent = activeDriversCount;
                if (totalDriversEl) totalDriversEl.textContent = totalDriversCount;
                if (totalUsersEl) totalUsersEl.textContent = totalDriversCount; // Utilisateurs = chauffeurs pour l'instant
                if (todayReservationsEl) todayReservationsEl.textContent = reservationsCount;
                
                // Mettre à jour les statistiques d'appels
                const callsReceivedCount = document.getElementById('callsReceivedCount');
                const reservationsCreatedCount = document.getElementById('reservationsCreatedCount');
                const conversionRate = document.getElementById('conversionRate');
                const callsPeriodLabel = document.getElementById('callsPeriodLabel');
                
                if (callsReceivedCount) callsReceivedCount.textContent = callsCount;
                if (reservationsCreatedCount) reservationsCreatedCount.textContent = reservationsCount;
                if (conversionRate) conversionRate.textContent = rate + '%';
                
                // Mettre à jour le label de période
                if (callsPeriodLabel) {
                    const periodLabels = {
                        'day': 'Aujourd\'hui',
                        'month': 'Ce mois',
                        'year': 'Cette année'
                    };
                    callsPeriodLabel.textContent = periodLabels[period] || 'Aujourd\'hui';
                }
            } catch (error) {
                console.error('❌ Erreur chargement stats:', error);
            }
        }

        // Définir la période active
        function setActivePeriod(period) {
            const buttons = document.querySelectorAll('.stats-period-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active', 'bg-green-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            const activeBtn = document.getElementById(`statsPeriod${period.charAt(0).toUpperCase() + period.slice(1)}`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'bg-green-600', 'text-white');
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
            }
        }

        // Mettre à jour la localisation d'un chauffeur sur la carte en temps réel
        function updateDriverLocationOnMap(data) {
            if (!adminMap || !data.driverId || !data.location) return;
            
            // Extraire les coordonnées
            const lat = data.location.latitude || data.location.lat;
            const lng = data.location.longitude || data.location.lng;
            
            if (!lat || !lng) return;
            
            // Trouver le marqueur existant
            const markerIndex = adminMarkers.findIndex(m => m.driverId === data.driverId);
            
            if (markerIndex !== -1) {
                // Mettre à jour la position du marqueur existant
                const marker = adminMarkers[markerIndex].marker;
                if (marker) {
                    marker.setLatLng([lat, lng]);
                    
                    // Mettre à jour le popup avec les nouvelles informations
                    if (data.driverData) {
                        const popupContent = `
                            <div style="text-align: center;">
                                <strong>${data.driverData.firstName || ''} ${data.driverData.lastName || ''}</strong><br>
                                ID: ${data.driverId}<br>
                                Téléphone: +227${data.driverData.phone || ''}<br>
                                Type: ${data.driverData.serviceType || ''}<br>
                                <button onclick="contactDriver('${data.driverData.phone || ''}')" class="mt-2 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">
                                    <i class="fas fa-phone mr-1"></i>Appeler
                                </button>
                            </div>
                        `;
                        marker.bindPopup(popupContent);
                    }
                }
            } else {
                // Créer un nouveau marqueur si le chauffeur n'était pas sur la carte
                if (data.driverData) {
                    addDriverMarkerToAdminMap({
                        driverId: data.driverId,
                        ...data.driverData,
                        isActive: true
                    });
                } else {
                    // Recharger les données si on n'a pas les infos complètes
                    loadDriversForAdmin();
                }
            }
        }
        
        // Ajouter un marqueur de chauffeur sur la carte admin
        function addDriverMarkerToAdminMap(driver) {
            if (!adminMap || !driver.location || !driver.driverId) return;
            
            // Vérifier si le marqueur existe déjà
            const existingIndex = adminMarkers.findIndex(m => m.driverId === driver.driverId);
            if (existingIndex !== -1) {
                // Mettre à jour le marqueur existant
                updateDriverLocationOnMap({
                    driverId: driver.driverId,
                    location: driver.location,
                    driverData: driver
                });
                return;
            }
            
            // Couleur selon le type de service
            let iconColor = '#10b981'; // Vert par défaut (Simple)
            if (driver.serviceType === 'standard' || driver.serviceType === 'STANDARD') {
                iconColor = '#f59e0b'; // Orange
            } else if (driver.serviceType === 'vip' || driver.serviceType === 'VIP') {
                iconColor = '#8b5cf6'; // Violet
            }
            
            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background: ${iconColor}; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); border: 3px solid white; animation: pulse 2s infinite;">
                    <i class="fas fa-taxi"></i>
                </div>`,
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });

            const lat = driver.location.latitude || driver.location.lat;
            const lng = driver.location.longitude || driver.location.lng;
            
            if (!lat || !lng) return;

            const marker = L.marker([lat, lng], { icon: customIcon })
                .addTo(adminMap)
                .bindPopup(`
                    <div style="text-align: center;">
                        <strong>${driver.firstName || ''} ${driver.lastName || ''}</strong><br>
                        ID: ${driver.driverId}<br>
                        Téléphone: +227${driver.phone || ''}<br>
                        Type: ${driver.serviceType || ''}<br>
                        <button onclick="contactDriver('${driver.phone || ''}')" class="mt-2 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">
                            <i class="fas fa-phone mr-1"></i>Appeler
                        </button>
                    </div>
                `);

            adminMarkers.push({ marker, driverId: driver.driverId });
        }
        
        // Supprimer un marqueur de la carte
        function removeDriverMarkerFromMap(driverId) {
            if (!adminMap) return;
            
            const markerIndex = adminMarkers.findIndex(m => m.driverId === driverId);
            if (markerIndex !== -1) {
                const markerData = adminMarkers[markerIndex];
                if (markerData.marker && adminMap.hasLayer(markerData.marker)) {
                    adminMap.removeLayer(markerData.marker);
                }
                adminMarkers.splice(markerIndex, 1);
            }
        }

        // Charger les chauffeurs pour l'admin
        async function loadDriversForAdmin() {
            try {
                // Charger tous les chauffeurs depuis Firebase
                const driversSnapshot = await db.collection('drivers').get();
                const drivers = [];
                
                driversSnapshot.forEach(doc => {
                    const driverData = doc.data();
                    drivers.push({
                        ...driverData,
                        driverId: doc.id,
                        isActive: driverData.isOnline === true && driverData.location != null
                    });
                });

                const driversList = document.getElementById('driversList');

                if (driversList) {
                    driversList.innerHTML = '';
                    
                    // Nettoyer les anciens marqueurs
                    adminMarkers.forEach(m => {
                        if (m.marker && adminMap) {
                            adminMap.removeLayer(m.marker);
                        }
                    });
                    adminMarkers = [];
                    
                    drivers.forEach((driver) => {
                        const driverCard = document.createElement('div');
                        driverCard.className = `p-3 border-b hover:bg-gray-50 cursor-pointer ${driver.isActive ? 'bg-green-50' : ''}`;
                        driverCard.innerHTML = `
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <p class="font-semibold">${driver.firstName} ${driver.lastName}</p>
                                    <p class="text-xs text-gray-600">ID: ${driver.driverId || 'N/A'}</p>
                                    <p class="text-xs text-gray-600">+227${driver.phone}</p>
                                    <p class="text-xs">
                                        <span class="px-2 py-1 rounded ${driver.isActive ? 'bg-green-200 text-green-800' : 'bg-gray-200 text-gray-600'}">
                                            ${driver.isActive ? 'Actif' : 'Inactif'}
                                        </span>
                                    </p>
                                </div>
                                <div class="text-right">
                                    ${driver.location ? `
                                        <button onclick="showDriverLocation('${driver.driverId}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </button>
                                    ` : ''}
                                    <button onclick="contactDriver('${driver.phone}')" class="text-green-600 hover:text-green-800 text-sm ml-2">
                                        <i class="fas fa-phone"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        driversList.appendChild(driverCard);

                        // Ajouter le marqueur sur la carte si actif et avec localisation
                        if (driver.isActive && driver.location && adminMap) {
                            addDriverMarkerToAdminMap(driver);
                        }
                    });
                }
            } catch (error) {
                console.error('❌ Erreur chargement chauffeurs:', error);
                alert('Erreur lors du chargement des chauffeurs: ' + error.message);
            }
        }

        // L'ancienne fonction addDriverMarker a été remplacée par addDriverMarkerToAdminMap
        // qui inclut les couleurs selon le type de service et une meilleure gestion

        // Filtrer les chauffeurs (filtrage côté client)
        function filterDrivers(searchTerm) {
            const driversList = document.getElementById('driversList');
            if (!driversList) return;

            const cards = driversList.querySelectorAll('div');
            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm.toLowerCase())) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Trouver le chauffeur le plus proche
        async function findNearestDriver() {
            const pickupAddress = document.getElementById('pickupAddress')?.value;
            const taxiType = document.getElementById('reservationTaxiType')?.value;
            const clientPhone = document.getElementById('clientPhone')?.value;

            if (!pickupAddress) {
                alert('Veuillez entrer l\'adresse de prise en charge.');
                return;
            }

            // Pour l'instant, utiliser une localisation par défaut (Niamey)
            // En production, utiliser un service de géocodage pour convertir l'adresse en coordonnées
            const pickupLocation = {
                latitude: 13.5127, // Niamey par défaut
                longitude: 2.1124
            };

            // Demander la géolocalisation si disponible
            if (navigator.geolocation) {
                try {
                    const position = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 5000 });
                    });
                    pickupLocation.latitude = position.coords.latitude;
                    pickupLocation.longitude = position.coords.longitude;
                } catch (error) {
                    console.log('Utilisation de la localisation par défaut');
                }
            }

            const adminPassword = 'admin123';

            try {
                // Trouver le chauffeur le plus proche via Firebase
                const taxiTypeForSearch = taxiType && taxiType !== 'all' ? taxiType.toUpperCase() : null;
                const drivers = await findAvailableDrivers(pickupLocation, taxiTypeForSearch, 1);
                
                if (drivers && drivers.length > 0) {
                    const driver = drivers[0]; // Le premier est le plus proche (trié par distance)

                    // Créer la réservation dans Firebase
                    const reservationData = {
                        clientPhone: clientPhone || '87776776',
                        pickupAddress: pickupAddress,
                        taxiType: taxiType || 'simple',
                        pickupLocation: {
                            latitude: pickupLocation.latitude,
                            longitude: pickupLocation.longitude
                        },
                        driverId: driver.driverId,
                        status: 'pending',
                        createdAt: getCurrentTimestamp(),
                        updatedAt: getCurrentTimestamp()
                    };
                    
                    await db.collection('bookings').add(reservationData);
                    console.log('✅ Réservation créée dans Firebase');

                    // Afficher les informations du chauffeur assigné
                    const assignedDriverInfo = document.getElementById('assignedDriverInfo');
                    const assignedDriverDetails = document.getElementById('assignedDriverDetails');
                    const contactDriverBtn = document.getElementById('contactDriverBtn');

                    if (assignedDriverInfo && assignedDriverDetails) {
                        assignedDriverDetails.innerHTML = `
                            <p><strong>Nom:</strong> ${driver.firstName} ${driver.lastName}</p>
                            <p><strong>ID:</strong> ${driver.driverId}</p>
                            <p><strong>Téléphone:</strong> +227${driver.phone}</p>
                            <p><strong>Type:</strong> ${driver.serviceType}</p>
                            <p><strong>Véhicule:</strong> ${driver.vehicleBrand} ${driver.vehicleColor || ''}</p>
                            ${driver.distance ? `<p><strong>Distance:</strong> ${driver.distance} km</p>` : ''}
                        `;
                        assignedDriverInfo.classList.remove('hidden');

                        if (contactDriverBtn) {
                            contactDriverBtn.onclick = () => contactDriver(driver.phone);
                        }

                        // Centrer la carte sur le chauffeur
                        if (adminMap && driver.location) {
                            adminMap.setView([driver.location.lat, driver.location.lng], 14);
                        }
                    }
                } else {
                    alert('Aucun chauffeur disponible pour le moment.');
                }
            } catch (error) {
                console.error('❌ Erreur:', error);
                alert('Erreur lors de la recherche du chauffeur. Veuillez réessayer.');
            }
        }

        // Contacter un chauffeur
        window.contactDriver = function(phone) {
            if (confirm(`Voulez-vous appeler ${phone} ?`)) {
                window.location.href = `tel:${phone}`;
            }
        };

        // Afficher la localisation d'un chauffeur
        window.showDriverLocation = async function(driverId) {
            try {
                // Récupérer le chauffeur depuis Firebase
                const driverDoc = await db.collection('drivers').doc(driverId).get();
                
                if (driverDoc.exists) {
                    const driver = driverDoc.data();
                    
                    if (driver.location && driver.location.lat && driver.location.lng && adminMap) {
                        adminMap.setView([driver.location.lat, driver.location.lng], 15);
                    }
                } else {
                    alert('Chauffeur introuvable.');
                }
            } catch (error) {
                console.error('❌ Erreur:', error);
                alert('Erreur lors de la récupération de la localisation du chauffeur.');
            }
        };

        // Le suivi en temps réel est maintenant géré par Firebase onSnapshot
        // Plus besoin de WebSocket - le code a été remplacé par Firebase

        // Mise à jour périodique de la liste (toutes les 10 secondes)
        setInterval(() => {
            if (adminModal && !adminModal.classList.contains('hidden')) {
                loadDriversForAdmin();
            }
        }, 10000);

        // ============================================
        // Connexion Chauffeur et Partage de Localisation
        // ============================================
        const driverLoginModal = document.getElementById('driverLoginModal');
        const driverLoginBtn = document.getElementById('driverLoginBtn');
        const closeDriverLoginModal = document.getElementById('closeDriverLoginModal');
        const driverLoginForm = document.getElementById('driverLoginForm');
        let driverLocationWatch = null;

        // Ouvrir la modal de connexion chauffeur
        if (driverLoginBtn && driverLoginModal) {
            driverLoginBtn.addEventListener('click', () => {
                driverLoginModal.classList.remove('hidden');
            });
        }

        // Ouvrir la modal depuis le menu mobile
        const driverLoginBtnMobile = document.getElementById('driverLoginBtnMobile');
        if (driverLoginBtnMobile && driverLoginModal) {
            driverLoginBtnMobile.addEventListener('click', () => {
                driverLoginModal.classList.remove('hidden');
                // Fermer le menu mobile
                const mobileMenu = document.getElementById('mobileMenu');
                if (mobileMenu) {
                    mobileMenu.classList.add('hidden');
                }
            });
        }

        // Fermer la modal de connexion chauffeur
        if (closeDriverLoginModal) {
            closeDriverLoginModal.addEventListener('click', () => {
                driverLoginModal.classList.add('hidden');
            });
        }

        // Gestion de la connexion chauffeur
        if (driverLoginForm) {
            driverLoginForm.addEventListener('submit', async function(e) {
                e.preventDefault();

                const phone = document.getElementById('driverLoginPhone')?.value;
                const pin = document.getElementById('driverLoginPin')?.value;
                const shareLocation = document.getElementById('shareLocationCheckbox')?.checked;

                if (!phone || phone.length !== 8) {
                    alert('Veuillez entrer un numéro de téléphone valide (8 chiffres).');
                    return;
                }

                if (!pin || pin.length < 4) {
                    alert('Veuillez entrer votre code PIN.');
                    return;
                }

                // Connexion via Firebase
                try {
                    // Vérifier que Firebase est initialisé
                    if (typeof db === 'undefined' || !db) {
                        alert('Erreur: Firebase n\'est pas initialisé. Veuillez rafraîchir la page.');
                        console.error('❌ Firebase db n\'est pas défini');
                        return;
                    }

                    // Rechercher le chauffeur par numéro de téléphone
                    const driversSnapshot = await db.collection('drivers')
                        .where('phone', '==', phone)
                        .limit(1)
                        .get();

                    if (driversSnapshot.empty) {
                        alert('Erreur: Numéro de téléphone ou code PIN incorrect.\n\nVérifiez que vous avez bien créé un compte avec ce numéro.');
                        console.log('❌ Aucun chauffeur trouvé avec le numéro:', phone);
                        return;
                    }

                    const driverDoc = driversSnapshot.docs[0];
                    const driverData = driverDoc.data();

                    // Vérifier le code PIN
                    if (!driverData.pin || driverData.pin !== pin) {
                        alert('Erreur: Numéro de téléphone ou code PIN incorrect.\n\nVérifiez votre code PIN et réessayez.');
                        console.log('❌ PIN incorrect. Attendu:', driverData.pin, 'Reçu:', pin);
                        return;
                    }
                    
                    console.log('✅ PIN correct, connexion en cours...');

                    // Connexion réussie
                    // Utiliser l'ID du document Firestore (qui est le driverId)
                    currentDriverId = driverDoc.id;

                    // Mettre à jour le statut de connexion
                    await db.collection('drivers').doc(currentDriverId).update({
                        lastLogin: getCurrentTimestamp(),
                        isOnline: true
                    });

                    // Si partage de localisation demandé
                    if (shareLocation) {
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(
                                async (position) => {
                                    const location = {
                                        latitude: position.coords.latitude,
                                        longitude: position.coords.longitude
                                    };

                                    // Enregistrer la localisation dans Firestore
                                    await db.collection('drivers').doc(currentDriverId).update({
                                        location: {
                                            lat: location.latitude,
                                            lng: location.longitude
                                        },
                                        locationUpdatedAt: getCurrentTimestamp()
                                    });

                                    // Démarrer le suivi de localisation
                                    startLocationTracking(currentDriverId);

                                    // Rediriger vers le tableau de bord du chauffeur
                                    window.location.href = `driver-dashboard.html?driverId=${currentDriverId}`;
                                },
                                (error) => {
                                    alert('Impossible d\'accéder à votre localisation. Veuillez autoriser l\'accès à la géolocalisation dans les paramètres de votre navigateur.');
                                    console.error('Erreur de géolocalisation:', error);
                                },
                                {
                                    enableHighAccuracy: true,
                                    timeout: 10000,
                                    maximumAge: 0
                                }
                            );
                        } else {
                            alert('La géolocalisation n\'est pas supportée par votre navigateur.');
                        }
                    } else {
                        // Connexion sans partage de localisation
                        // Rediriger quand même vers le tableau de bord
                        // L'utilisateur pourra activer le partage de localisation depuis là
                        window.location.href = `driver-dashboard.html?driverId=${currentDriverId}`;
                    }
                } catch (error) {
                    console.error('❌ Erreur de connexion:', error);
                    console.error('Détails de l\'erreur:', {
                        message: error.message,
                        code: error.code,
                        stack: error.stack
                    });
                    alert('Erreur de connexion au serveur. Veuillez réessayer plus tard.\n\nErreur: ' + error.message + '\n\nOuvrez la console (F12) pour plus de détails.');
                }
            });
        }

        // Démarrer le suivi de localisation
        function startLocationTracking(driverId) {
            if (driverLocationWatch) {
                navigator.geolocation.clearWatch(driverLocationWatch);
            }

            driverLocationWatch = navigator.geolocation.watchPosition(
                async (position) => {
                    const location = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };

                    // Mettre à jour dans Firebase
                    try {
                        await db.collection('drivers').doc(driverId).update({
                            location: {
                                lat: location.latitude,
                                lng: location.longitude
                            },
                            locationUpdatedAt: getCurrentTimestamp()
                        });
                        console.log('✅ Localisation mise à jour dans Firebase');
                    } catch (error) {
                        console.error('❌ Erreur mise à jour localisation:', error);
                    }
                },
                (error) => {
                    console.error('Erreur de suivi de localisation:', error);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                }
            );
        }

        // Afficher une notification de statut pour le chauffeur
        function showDriverStatusNotification(isActive) {
            // Créer une notification flottante
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${isActive ? 'bg-green-500' : 'bg-gray-500'} text-white`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${isActive ? 'fa-check-circle' : 'fa-times-circle'} mr-2"></i>
                    <span>${isActive ? 'Vous êtes maintenant actif et visible sur la carte' : 'Vous êtes maintenant inactif'}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Validation du numéro de téléphone dans le formulaire de connexion
        const driverLoginPhoneInput = document.getElementById('driverLoginPhone');
        if (driverLoginPhoneInput) {
            driverLoginPhoneInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '').slice(0, 8);
            });
        }

        // Validation du PIN dans le formulaire de connexion
        const driverLoginPinInput = document.getElementById('driverLoginPin');
        if (driverLoginPinInput) {
            driverLoginPinInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/\D/g, '').slice(0, 6);
            });
        }

        // ============================================
        // Gestion du Formulaire de Contact
        // ============================================
        const contactForm = document.getElementById('contactForm');
        const sendMethodModal = document.getElementById('sendMethodModal');
        const closeSendMethodModal = document.getElementById('closeSendMethodModal');
        const sendWhatsAppBtn = document.getElementById('sendWhatsAppBtn');
        const sendEmailBtn = document.getElementById('sendEmailBtn');
        let contactFormData = null;

        // Fermer la modal de choix
        if (closeSendMethodModal) {
            closeSendMethodModal.addEventListener('click', () => {
                sendMethodModal.classList.add('hidden');
            });
        }

        // Gérer la soumission du formulaire de contact
        if (contactForm) {
            contactForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Valider le formulaire
                if (!this.checkValidity()) {
                    this.reportValidity();
                    return;
                }
                
                // Récupérer les données du formulaire
                contactFormData = {
                    name: document.getElementById('contactName').value.trim(),
                    firstName: document.getElementById('contactFirstName').value.trim(),
                    subject: document.getElementById('contactSubject').value,
                    message: document.getElementById('contactMessage').value.trim()
                };
                
                // Afficher la modal de choix
                if (sendMethodModal) {
                    sendMethodModal.classList.remove('hidden');
                }
            });
        }

        // Envoyer par WhatsApp
        if (sendWhatsAppBtn) {
            sendWhatsAppBtn.addEventListener('click', function() {
                if (!contactFormData) return;
                
                // Formater le message pour WhatsApp
                const whatsappMessage = `*Dréba VTC - ${contactFormData.subject}*\n\n` +
                    `*Nom:* ${contactFormData.name} ${contactFormData.firstName}\n` +
                    `*Sujet:* ${contactFormData.subject}\n\n` +
                    `*Message:*\n${contactFormData.message}`;
                
                // Encoder le message pour l'URL
                const encodedMessage = encodeURIComponent(whatsappMessage);
                
                // Numéro WhatsApp (format international sans +)
                const whatsappNumber = '22787776776';
                
                // Ouvrir WhatsApp
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
                
                // Fermer la modal
                sendMethodModal.classList.add('hidden');
                
                // Réinitialiser le formulaire
                contactForm.reset();
                contactFormData = null;
                
                // Afficher un message de confirmation
                alert('Redirection vers WhatsApp...\n\nVotre message est prêt à être envoyé !');
            });
        }

        // Envoyer par Email
        if (sendEmailBtn) {
            sendEmailBtn.addEventListener('click', function() {
                if (!contactFormData) return;
                
                // Formater le sujet de l'email
                const emailSubject = encodeURIComponent(`Dréba VTC - ${contactFormData.subject}`);
                
                // Formater le corps de l'email
                const emailBody = encodeURIComponent(
                    `Bonjour,\n\n` +
                    `Vous avez reçu un nouveau message depuis le formulaire de contact du site Dréba VTC.\n\n` +
                    `---\n` +
                    `Nom: ${contactFormData.name} ${contactFormData.firstName}\n` +
                    `Sujet: ${contactFormData.subject}\n\n` +
                    `Message:\n${contactFormData.message}\n` +
                    `---\n\n` +
                    `Ce message a été envoyé depuis le formulaire de contact du site web.`
                );
                
                // Adresse email
                const emailAddress = 'taxidreba@gmail.com';
                
                // Ouvrir le client email
                const mailtoUrl = `mailto:${emailAddress}?subject=${emailSubject}&body=${emailBody}`;
                window.location.href = mailtoUrl;
                
                // Fermer la modal
                sendMethodModal.classList.add('hidden');
                
                // Réinitialiser le formulaire
                contactForm.reset();
                contactFormData = null;
                
                // Afficher un message de confirmation
                alert('Ouverture de votre client email...\n\nLe message est prêt à être envoyé à taxidreba@gmail.com');
            });
        }

        // ============================================
        // Fonctions Helper pour Firebase
        // ============================================
        
        // Fonction pour calculer la distance entre deux points (formule de Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Rayon de la Terre en km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // Distance en km
        }

        // Fonction pour trouver les chauffeurs disponibles via Firebase
        async function findAvailableDrivers(pickupLocation, taxiType, limit = 10) {
            try {
                // Vérifier que Firebase est initialisé
                if (typeof db === 'undefined' || !db) {
                    const error = new Error('Firebase n\'est pas initialisé. Veuillez rafraîchir la page.');
                    error.type = 'FIREBASE_NOT_INITIALIZED';
                    throw error;
                }

                console.log('🔍 Recherche de chauffeurs disponibles...', {
                    pickupLocation,
                    taxiType,
                    limit
                });

                // Récupérer TOUS les chauffeurs (évite les problèmes d'index)
                // On filtrera côté client pour isOnline, location, etc.
                let driversSnapshot;
                try {
                    driversSnapshot = await db.collection('drivers').get();
                    console.log('✅ Chauffeurs récupérés:', driversSnapshot.size);
                } catch (firestoreError) {
                    console.error('❌ Erreur Firestore lors de la récupération:', firestoreError);
                    console.error('❌ Détails de l\'erreur Firestore:', {
                        code: firestoreError.code,
                        message: firestoreError.message,
                        name: firestoreError.name,
                        stack: firestoreError.stack
                    });
                    
                    // Créer une erreur enrichie avec toutes les informations
                    const error = new Error(firestoreError.message || 'Erreur lors de la récupération des chauffeurs depuis Firestore.');
                    error.code = firestoreError.code;
                    error.originalError = firestoreError;
                    
                    // Vérifier si c'est une erreur de permissions
                    if (firestoreError.code === 'permission-denied' || 
                        firestoreError.code === 'PERMISSION_DENIED' ||
                        (firestoreError.message && firestoreError.message.toLowerCase().includes('permission'))) {
                        error.type = 'PERMISSION_DENIED';
                        error.message = 'Permissions Firestore insuffisantes. Vérifiez les règles Firestore dans la console Firebase (Firestore Database → Règles).';
                        throw error;
                    }
                    
                    // Vérifier si c'est une erreur d'index
                    if (firestoreError.message && firestoreError.message.toLowerCase().includes('index')) {
                        error.type = 'INDEX_REQUIRED';
                        error.message = 'Index Firestore manquant. Cliquez sur le lien dans la console pour créer l\'index.';
                        throw error;
                    }
                    
                    // Autres erreurs Firebase
                    error.type = 'FIRESTORE_ERROR';
                    throw error;
                }

                const availableDrivers = [];
                let totalDrivers = 0;
                let onlineDrivers = 0;
                let driversWithLocation = 0;

                driversSnapshot.forEach(doc => {
                    totalDrivers++;
                    const driver = doc.data();
                    
                    // Vérifier que le chauffeur est en ligne
                    if (!driver.isOnline || driver.isOnline !== true) {
                        return; // Passer au suivant
                    }
                    onlineDrivers++;
                    
                    // Vérifier que le chauffeur a une localisation
                    if (!driver.location || !driver.location.lat || !driver.location.lng) {
                        return; // Passer au suivant
                    }
                    driversWithLocation++;
                    
                    // Vérifier le statut (approuvé ou actif) - optionnel pour l'instant
                    // if (driver.status && driver.status !== 'approved' && driver.status !== 'active') {
                    //     return; // Passer au suivant si le statut n'est pas bon
                    // }

                    // Vérifier le type de service si spécifié
                    if (taxiType && driver.serviceType) {
                        const driverType = (driver.serviceType || '').toUpperCase();
                        const requestedType = (taxiType || '').toUpperCase();
                        if (driverType !== requestedType) {
                            return; // Type ne correspond pas
                        }
                    }

                    // Calculer la distance
                    const distance = calculateDistance(
                        pickupLocation.latitude,
                        pickupLocation.longitude,
                        driver.location.lat,
                        driver.location.lng
                    );

                    availableDrivers.push({
                        driverId: doc.id,
                        firstName: driver.firstName || '',
                        lastName: driver.lastName || '',
                        phone: driver.phone || '',
                        serviceType: driver.serviceType || 'simple',
                        vehicleBrand: driver.vehicleBrand || '',
                        vehicleColor: driver.vehicleColor || '',
                        location: driver.location,
                        distance: Math.round(distance * 10) / 10 // Arrondir à 1 décimale
                    });
                });

                console.log('📊 Statistiques de recherche:', {
                    total: totalDrivers,
                    enLigne: onlineDrivers,
                    avecLocalisation: driversWithLocation,
                    disponibles: availableDrivers.length
                });

                // Trier par distance (plus proche en premier)
                availableDrivers.sort((a, b) => a.distance - b.distance);

                // Limiter le nombre de résultats
                return availableDrivers.slice(0, limit);
            } catch (error) {
                console.error('❌ Erreur recherche chauffeurs Firebase:', error);
                console.error('Détails de l\'erreur:', {
                    message: error.message,
                    code: error.code,
                    type: error.type,
                    stack: error.stack
                });
                throw error;
            }
        }

        // ============================================
        // Gestion du Formulaire de Réservation - Trouver un véhicule
        // ============================================
        const bookingForm = document.getElementById('bookingForm');
        const selectedVehicleDiv = document.getElementById('selectedVehicle');

        if (bookingForm) {
            bookingForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Récupérer les données du formulaire
                const taxiCategory = document.getElementById('taxiCategorySelect')?.value || 'simple';
                
                // Vérifier qu'un point de départ est défini
                if (!pickupMarker) {
                    alert('Veuillez définir un point de départ en cliquant sur la carte ou en utilisant votre position.');
                    return;
                }
                
                const pickupLatLng = pickupMarker.getLatLng();
                const pickupLocation = {
                    latitude: pickupLatLng.lat,
                    longitude: pickupLatLng.lng
                };
                
                // Mapper le type de taxi (simple -> SIMPLE, standard -> STANDARD, vip -> VIP)
                const taxiTypeMap = {
                    'simple': 'SIMPLE',
                    'standard': 'STANDARD',
                    'vip': 'VIP'
                };
                const mappedTaxiType = taxiTypeMap[taxiCategory] || taxiCategory.toUpperCase();
                
                // Afficher un indicateur de chargement
                const submitBtn = bookingForm.querySelector('button[type="submit"]');
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Recherche en cours...';
                
                try {
                    console.log('🚀 Début de la recherche de véhicules...');
                    console.log('🔍 Vérification Firebase:', {
                        dbDefined: typeof db !== 'undefined',
                        firebaseDefined: typeof firebase !== 'undefined',
                        firestoreDefined: typeof firebase?.firestore !== 'undefined'
                    });
                    
                    // Vérification supplémentaire de Firebase
                    if (typeof db === 'undefined' || !db) {
                        throw new Error('Firebase Firestore n\'est pas initialisé. Veuillez rafraîchir la page (F5).');
                    }
                    
                    // Rechercher les chauffeurs disponibles via Firebase
                    const drivers = await findAvailableDrivers(pickupLocation, mappedTaxiType, 10);
                    
                    console.log('✅ Résultat de la recherche:', {
                        driversFound: drivers ? drivers.length : 0,
                        drivers: drivers
                    });

                    if (drivers && drivers.length > 0) {
                        
                        if (drivers.length > 0) {
                            // Afficher la liste des véhicules
                            displayVehiclesList(drivers);
                            
                            // Ajouter les marqueurs sur la carte
                            if (map) {
                                // Supprimer les anciens marqueurs de véhicules
                                vehicleMarkers.forEach(marker => {
                                    if (map.hasLayer(marker)) {
                                        map.removeLayer(marker);
                                    }
                                });
                                vehicleMarkers = [];
                                
                                // Ajouter un marqueur pour chaque chauffeur
                                drivers.forEach((driver, index) => {
                                    // Couleur différente selon le type
                                    let iconColor = '#10b981'; // Vert par défaut
                                    if (driver.serviceType === 'STANDARD') {
                                        iconColor = '#f59e0b'; // Orange
                                    } else if (driver.serviceType === 'VIP') {
                                        iconColor = '#8b5cf6'; // Violet
                                    }
                                    
                                    const driverIcon = L.divIcon({
                                        className: 'custom-driver-marker',
                                        html: `<div style="background: ${iconColor}; width: 40px; height: 40px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-taxi" style="color: white; font-size: 20px;"></i></div>`,
                                        iconSize: [40, 40],
                                        iconAnchor: [20, 40]
                                    });
                                    
                                    const driverMarker = L.marker([driver.location.lat, driver.location.lng], { icon: driverIcon })
                                        .addTo(map)
                                        .bindPopup(`
                                            <div style="text-align: center;">
                                                <strong>${driver.firstName} ${driver.lastName}</strong><br>
                                                ${driver.serviceType}<br>
                                                ${driver.vehicleBrand} ${driver.vehicleColor || ''}<br>
                                                ${driver.distance ? `Distance: ${driver.distance} km` : ''}<br>
                                                <button onclick="contactDriver('${driver.phone}')" class="mt-2 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">
                                                    <i class="fas fa-phone mr-1"></i>Appeler
                                                </button>
                                            </div>
                                        `);
                                    
                                    vehicleMarkers.push(driverMarker);
                                });
                                
                                // Ajuster la vue pour voir tous les véhicules
                                if (pickupMarker && vehicleMarkers.length > 0) {
                                    const group = new L.featureGroup([pickupMarker, ...vehicleMarkers]);
                                    map.fitBounds(group.getBounds().pad(0.2));
                                }
                            }
                            
                            // Message de succès
                            const vehiclesCount = drivers.length;
                            const message = vehiclesCount === 1 
                                ? `1 véhicule trouvé !`
                                : `${vehiclesCount} véhicules trouvés !`;
                            
                            // Notification discrète
                            showNotification(message, 'success');
                        } else {
                            // Aucun véhicule trouvé
                            if (selectedVehicleDiv) {
                                selectedVehicleDiv.innerHTML = `
                                    <div class="text-center py-6">
                                        <div class="mb-6">
                                            <i class="fas fa-taxi text-5xl text-green-300 mb-4 animate-pulse"></i>
                                            <p class="text-green-200 text-base font-semibold mb-2">Aucun véhicule disponible pour le moment</p>
                                            <p class="text-green-300 text-sm mb-6">Réessayez plus tard ou contactez-nous directement par téléphone</p>
                                        </div>
                                        <a href="tel:+22787776776" class="inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-bold text-lg hover:from-green-600 hover:to-emerald-700 transition transform hover:scale-110 shadow-2xl animate-pulse border-2 border-white">
                                            <i class="fas fa-phone mr-3 text-xl"></i>
                                            Appeler le 87 77 67 76
                                        </a>
                                        <p class="text-green-200 text-xs mt-4">Cliquez pour appeler directement</p>
                                    </div>
                                `;
                            }
                            if (document.getElementById('vehiclesCount')) {
                                document.getElementById('vehiclesCount').textContent = '(0)';
                            }
                            // Notification non-bloquante au lieu d'alerte
                            showNotification('Aucun chauffeur disponible. Utilisez le bouton d\'appel ci-dessous pour nous contacter.', 'warning');
                            
                            // Faire défiler vers le bouton d'appel pour qu'il soit visible
                            setTimeout(() => {
                                if (selectedVehicleDiv) {
                                    selectedVehicleDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                }
                            }, 500);
                        }
                    } else {
                        // Aucun véhicule trouvé - déjà géré dans le code ci-dessus
                    }
                } catch (error) {
                    console.error('❌ Erreur lors de la recherche:', error);
                    console.error('❌ Type d\'erreur:', typeof error);
                    console.error('❌ Code d\'erreur:', error.code);
                    console.error('❌ Message d\'erreur:', error.message);
                    console.error('❌ Stack trace:', error.stack);
                    
                    // Message d'erreur personnalisé selon le type d'erreur
                    let errorMessage = 'Erreur lors de la recherche de véhicules.';
                    let errorDetails = '';
                    
                    // Vérifier le code d'erreur Firebase
                    const errorCode = error.code || error.originalError?.code || '';
                    const errorMsg = error.message || error.originalError?.message || String(error);
                    
                    if (error.type === 'FIREBASE_NOT_INITIALIZED' || errorMsg.includes('Firebase n\'est pas initialisé')) {
                        errorMessage = 'Firebase n\'est pas initialisé.';
                        errorDetails = 'Veuillez rafraîchir la page (F5) et réessayer.';
                    } else if (error.type === 'PERMISSION_DENIED' || errorCode === 'permission-denied' || errorMsg.includes('permission')) {
                        errorMessage = 'Erreur de permissions Firestore.';
                        errorDetails = 'Les règles Firestore bloquent l\'accès. Vérifiez les règles dans Firebase Console (Firestore Database → Règles).';
                    } else if (error.type === 'INDEX_REQUIRED' || errorMsg.includes('index')) {
                        errorMessage = 'Index Firestore manquant.';
                        errorDetails = 'Ouvrez la console (F12) et cliquez sur le lien pour créer l\'index automatiquement.';
                    } else if (errorMsg.includes('network') || errorMsg.includes('Network')) {
                        errorMessage = 'Erreur de connexion réseau.';
                        errorDetails = 'Vérifiez votre connexion internet et réessayez.';
                    } else {
                        errorMessage = 'Erreur lors de la recherche.';
                        errorDetails = `Erreur: ${errorMsg}. Ouvrez la console (F12) pour plus de détails.`;
                    }
                    
                    // Afficher un message d'erreur détaillé
                    alert(`${errorMessage}\n\n${errorDetails}\n\nCode d'erreur: ${errorCode || 'N/A'}\n\nEn cas de problème persistant, appelez le 87 77 67 76 pour réserver.`);
                    
                    // Masquer la section véhicule sélectionné avec bouton d'appel
                    if (selectedVehicleDiv) {
                        selectedVehicleDiv.innerHTML = `
                            <div class="text-center py-6">
                                <div class="mb-4">
                                    <i class="fas fa-exclamation-triangle text-4xl text-yellow-300 mb-3"></i>
                                    <p class="text-green-200 text-sm mb-2 font-semibold">${errorMessage}</p>
                                    <p class="text-green-300 text-xs mb-2">${errorDetails}</p>
                                    <p class="text-green-200 text-xs mt-4">Ouvrez la console (F12) pour voir les détails de l'erreur.</p>
                                </div>
                                <a href="tel:+22787776776" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition transform hover:scale-105 shadow-lg">
                                    <i class="fas fa-phone mr-2"></i>
                                    Appeler le 87 77 67 76
                                </a>
                            </div>
                        `;
                    }
                } finally {
                    // Réactiver le bouton
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalBtnText;
                }
            });
            
            // Gestionnaire direct sur le bouton pour éviter toute redirection
            const findVehicleBtn = document.getElementById('findVehicleBtn');
            if (findVehicleBtn) {
                findVehicleBtn.addEventListener('click', async function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Récupérer les données du formulaire
                    const taxiCategory = document.getElementById('taxiCategorySelect')?.value || 'simple';
                    
                    // Vérifier qu'un point de départ est défini
                    if (!pickupMarker) {
                        alert('Veuillez définir un point de départ en cliquant sur la carte ou en utilisant votre position.');
                        return;
                    }
                    
                    const pickupLatLng = pickupMarker.getLatLng();
                    const pickupLocation = {
                        latitude: pickupLatLng.lat,
                        longitude: pickupLatLng.lng
                    };
                    
                    // Mapper le type de taxi (simple -> SIMPLE, standard -> STANDARD, vip -> VIP)
                    const taxiTypeMap = {
                        'simple': 'SIMPLE',
                        'standard': 'STANDARD',
                        'vip': 'VIP'
                    };
                    const mappedTaxiType = taxiTypeMap[taxiCategory] || taxiCategory.toUpperCase();
                    
                    // Afficher un indicateur de chargement
                    const submitBtn = findVehicleBtn;
                    const originalBtnText = submitBtn.innerHTML;
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Recherche en cours...';
                    
                    try {
                        // Rechercher les chauffeurs disponibles via Firebase
                        const drivers = await findAvailableDrivers(pickupLocation, mappedTaxiType, 10);

                        if (drivers && drivers.length > 0) {
                            
                            if (drivers.length > 0) {
                                // Afficher la liste des véhicules
                                displayVehiclesList(drivers);
                                
                                // Ajouter les marqueurs sur la carte
                                if (map) {
                                    // Supprimer les anciens marqueurs de véhicules
                                    vehicleMarkers.forEach(marker => {
                                        if (map.hasLayer(marker)) {
                                            map.removeLayer(marker);
                                        }
                                    });
                                    vehicleMarkers = [];
                                    
                                    // Ajouter un marqueur pour chaque chauffeur
                                    drivers.forEach((driver, index) => {
                                        // Couleur différente selon le type
                                        let iconColor = '#10b981'; // Vert par défaut
                                        if (driver.serviceType === 'STANDARD') {
                                            iconColor = '#f59e0b'; // Orange
                                        } else if (driver.serviceType === 'VIP') {
                                            iconColor = '#8b5cf6'; // Violet
                                        }
                                        
                                        const driverIcon = L.divIcon({
                                            className: 'custom-driver-marker',
                                            html: `<div style="background: ${iconColor}; width: 40px; height: 40px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;"><i class="fas fa-taxi" style="color: white; font-size: 20px;"></i></div>`,
                                            iconSize: [40, 40],
                                            iconAnchor: [20, 20]
                                        });
                                        
                                        const driverMarker = L.marker([driver.location.lat, driver.location.lng], { icon: driverIcon })
                                            .addTo(map)
                                            .bindPopup(`
                                                <div class="text-center">
                                                    <strong>${driver.firstName} ${driver.lastName}</strong><br>
                                                    ${driver.serviceType}<br>
                                                    ${driver.vehicleBrand} ${driver.vehicleColor || ''}<br>
                                                    ${driver.distance ? `Distance: ${driver.distance} km` : ''}<br>
                                                    <button onclick="contactDriver('${driver.phone}')" class="mt-2 px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700">
                                                        <i class="fas fa-phone mr-1"></i>Appeler
                                                    </button>
                                                </div>
                                            `);
                                        
                                        vehicleMarkers.push(driverMarker);
                                    });
                                    
                                    // Ajuster la vue pour voir tous les véhicules
                                    if (pickupMarker && vehicleMarkers.length > 0) {
                                        const group = new L.featureGroup([pickupMarker, ...vehicleMarkers]);
                                        map.fitBounds(group.getBounds().pad(0.2));
                                    }
                                }
                                
                                // Message de succès
                                const vehiclesCount = drivers.length;
                                const message = vehiclesCount === 1 
                                    ? `1 véhicule trouvé !`
                                    : `${vehiclesCount} véhicules trouvés !`;
                                
                                // Notification discrète
                                showNotification(message, 'success');
                            } else {
                                // Aucun véhicule trouvé
                                if (selectedVehicleDiv) {
                                    selectedVehicleDiv.innerHTML = `
                                        <div class="text-center py-6">
                                            <div class="mb-4">
                                                <i class="fas fa-taxi text-4xl text-green-300 mb-3"></i>
                                                <p class="text-green-200 text-sm mb-2">Aucun véhicule disponible pour le moment</p>
                                                <p class="text-green-300 text-xs mb-4">Réessayez plus tard ou contactez-nous directement</p>
                                            </div>
                                            <a href="tel:+22787776776" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition transform hover:scale-105 shadow-lg">
                                                <i class="fas fa-phone mr-2"></i>
                                                Appeler le 87 77 67 76
                                            </a>
                                        </div>
                                    `;
                                }
                                if (document.getElementById('vehiclesCount')) {
                                    document.getElementById('vehiclesCount').textContent = '(0)';
                                }
                                alert('Aucun chauffeur disponible pour le moment. Un bouton d\'appel est disponible ci-dessous.');
                            }
                        } else {
                            // Aucun véhicule trouvé - déjà géré dans le code ci-dessus
                        }
                    } catch (error) {
                        console.error('❌ Erreur lors de la recherche:', error);
                        
                        // Message d'erreur personnalisé selon le type d'erreur
                        let errorMessage = 'Erreur lors de la recherche de véhicules.';
                        let errorDetails = '';
                        
                        if (error.type === 'FIREBASE_NOT_INITIALIZED') {
                            errorMessage = 'Firebase n\'est pas initialisé.';
                            errorDetails = 'Veuillez rafraîchir la page (F5) et réessayer.';
                        } else if (error.type === 'PERMISSION_DENIED') {
                            errorMessage = 'Erreur de permissions Firestore.';
                            errorDetails = 'Vérifiez les règles Firestore dans la console Firebase. Ouvrez la console (F12) pour plus de détails.';
                        } else if (error.type === 'INDEX_REQUIRED') {
                            errorMessage = 'Index Firestore manquant.';
                            errorDetails = 'Ouvrez la console (F12) et cliquez sur le lien pour créer l\'index automatiquement.';
                        } else if (error.code === 'permission-denied' || error.message?.includes('permission')) {
                            errorMessage = 'Permissions Firestore insuffisantes.';
                            errorDetails = 'Les règles Firestore bloquent l\'accès. Vérifiez les règles dans Firebase Console.';
                        } else if (error.message?.includes('index')) {
                            errorMessage = 'Index Firestore requis.';
                            errorDetails = 'Ouvrez la console (F12) pour voir le lien de création d\'index.';
                        } else {
                            errorMessage = 'Erreur lors de la recherche.';
                            errorDetails = `Erreur: ${error.message || 'Erreur inconnue'}. Ouvrez la console (F12) pour plus de détails.`;
                        }
                        
                        // Afficher un message d'erreur détaillé
                        alert(`${errorMessage}\n\n${errorDetails}\n\nEn cas de problème persistant, appelez le 87 77 67 76 pour réserver.`);
                        
                        // Masquer la section véhicule sélectionné avec bouton d'appel
                        if (selectedVehicleDiv) {
                            selectedVehicleDiv.innerHTML = `
                                <div class="text-center py-6">
                                    <div class="mb-4">
                                        <i class="fas fa-exclamation-triangle text-4xl text-yellow-300 mb-3"></i>
                                        <p class="text-green-200 text-sm mb-2 font-semibold">${errorMessage}</p>
                                        <p class="text-green-300 text-xs mb-2">${errorDetails}</p>
                                        <p class="text-green-200 text-xs mt-4">Ouvrez la console (F12) pour voir les détails de l'erreur.</p>
                                    </div>
                                    <a href="tel:+22787776776" class="inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition transform hover:scale-105 shadow-lg">
                                        <i class="fas fa-phone mr-2"></i>
                                        Appeler le 87 77 67 76
                                    </a>
                                </div>
                            `;
                        }
                    } finally {
                        // Réactiver le bouton
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalBtnText;
                    }
                });
            }
        }

        // Afficher la liste des véhicules disponibles
        function displayVehiclesList(drivers) {
            if (!selectedVehicleDiv) return;
            
            // Mettre à jour le compteur
            const vehiclesCount = document.getElementById('vehiclesCount');
            if (vehiclesCount) {
                vehiclesCount.textContent = `(${drivers.length})`;
            }
            
            if (drivers.length === 0) {
                selectedVehicleDiv.innerHTML = `
                    <div class="text-center py-6">
                        <div class="mb-6">
                            <i class="fas fa-taxi text-5xl text-green-300 mb-4 animate-pulse"></i>
                            <p class="text-green-200 text-base font-semibold mb-2">Aucun véhicule disponible pour le moment</p>
                            <p class="text-green-300 text-sm mb-6">Réessayez plus tard ou contactez-nous directement par téléphone</p>
                        </div>
                        <a href="tel:+22787776776" class="inline-flex items-center justify-center px-8 py-4 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-bold text-lg hover:from-green-600 hover:to-emerald-700 transition transform hover:scale-110 shadow-2xl animate-pulse border-2 border-white">
                            <i class="fas fa-phone mr-3 text-xl"></i>
                            Appeler le 87 77 67 76
                        </a>
                        <p class="text-green-200 text-xs mt-4">Cliquez pour appeler directement</p>
                    </div>
                `;
                return;
            }
            
            // Trier par distance (plus proche en premier)
            drivers.sort((a, b) => {
                const distA = a.distance || Infinity;
                const distB = b.distance || Infinity;
                return distA - distB;
            });
            
            // Générer le HTML pour chaque véhicule
            selectedVehicleDiv.innerHTML = drivers.map((driver, index) => {
                // Déterminer l'image selon le type
                let vehicleImage = 'Photo Taxi/Taxi Simple (1).jpeg';
                let typeLabel = 'Simple';
                let typeColor = 'bg-green-500';
                
                if (driver.serviceType === 'STANDARD') {
                    vehicleImage = 'Photo Taxi/Taxi Standard.jpeg';
                    typeLabel = 'Standard';
                    typeColor = 'bg-orange-500';
                } else if (driver.serviceType === 'VIP') {
                    vehicleImage = 'Photo Taxi/Taxi VIP (1).jpeg';
                    typeLabel = 'VIP';
                    typeColor = 'bg-purple-500';
                }
                
                // Badge "Plus proche" pour le premier
                const isNearest = index === 0 && driver.distance;
                
                return `
                    <div class="bg-green-800 rounded-lg p-3 hover:bg-green-900 transition cursor-pointer ${isNearest ? 'ring-2 ring-yellow-400' : ''}" onclick="selectVehicle(${index}, '${driver.driverId}')">
                        <div class="flex items-start">
                            <div class="mr-3 flex-shrink-0">
                                <img src="${vehicleImage}" alt="${driver.serviceType}" class="w-16 h-16 rounded-lg object-cover">
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center justify-between mb-1">
                                    <p class="font-bold text-white text-sm truncate">${driver.firstName} ${driver.lastName}</p>
                                    <span class="px-2 py-0.5 ${typeColor} text-white text-xs rounded-full ml-2">${typeLabel}</span>
                                </div>
                                <p class="text-xs text-green-200 truncate">${driver.vehicleBrand} ${driver.vehicleColor || ''}</p>
                                ${driver.distance ? `
                                    <div class="flex items-center mt-1">
                                        <i class="fas fa-route text-green-300 text-xs mr-1"></i>
                                        <span class="text-xs text-green-200">${driver.distance} km</span>
                                        ${isNearest ? '<span class="ml-2 px-1.5 py-0.5 bg-yellow-400 text-yellow-900 text-xs rounded font-semibold">Plus proche</span>' : ''}
                                    </div>
                                ` : ''}
                                <div class="flex items-center mt-1">
                                    <div class="flex text-yellow-400 text-xs">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                    </div>
                                    <span class="text-xs ml-1 text-green-200">(4.5)</span>
                                </div>
                                <button onclick="event.stopPropagation(); contactDriver('${driver.phone}');" class="mt-2 w-full px-3 py-1.5 bg-white text-green-600 rounded-lg font-semibold hover:bg-gray-100 transition text-xs">
                                    <i class="fas fa-phone mr-1"></i>Contacter
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Sélectionner un véhicule
        window.selectVehicle = function(index, driverId) {
            // Scroll vers le véhicule sélectionné
            const vehicles = selectedVehicleDiv.querySelectorAll('div');
            if (vehicles[index]) {
                vehicles[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // Mettre en évidence le véhicule sélectionné
                vehicles.forEach((v, i) => {
                    if (i === index) {
                        v.classList.add('ring-2', 'ring-yellow-400');
                    } else {
                        v.classList.remove('ring-2', 'ring-yellow-400');
                    }
                });
            }
            
            // Centrer la carte sur le véhicule sélectionné
            if (vehicleMarkers[index] && map) {
                const marker = vehicleMarkers[index];
                map.setView(marker.getLatLng(), 16);
                marker.openPopup();
            }
        }
        
        // Fonction pour afficher une notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' : 
                'bg-blue-500'
            } text-white max-w-md`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' : 
                        type === 'error' ? 'fa-exclamation-circle' : 
                        type === 'warning' ? 'fa-exclamation-triangle' : 
                        'fa-info-circle'
                    } mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        // Enregistrer un appel dans Firebase
        async function registerCall(phoneNumber = '87776776', callType = 'reservation') {
            try {
                await db.collection('calls').add({
                    phoneNumber: phoneNumber,
                    callType: callType,
                    timestamp: getCurrentTimestamp(),
                    date: new Date().toISOString()
                });
                console.log('✅ Appel enregistré dans Firebase');
            } catch (error) {
                console.error('❌ Erreur enregistrement appel:', error);
            }
        }

        // Enregistrer les appels quand on clique sur les boutons d'appel
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a[href^="tel:"]');
            if (link) {
                const phoneNumber = link.getAttribute('href').replace('tel:', '').replace('+227', '');
                registerCall(phoneNumber, 'reservation');
            }
        });
    </script>
    <!-- Configuration Firebase - Intégrée directement -->
    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCF55ufr-zZ3K-b6FlIUAEcjsicbXmNZo8",
            authDomain: "dreba-vtc-niger.firebaseapp.com",
            projectId: "dreba-vtc-niger",
            storageBucket: "dreba-vtc-niger.firebasestorage.app",
            messagingSenderId: "307924459980",
            appId: "1:307924459980:web:025fab54728dfa01e7bd69",
            measurementId: "G-F3ZJFEPZHF"
        };

        // Initialiser Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log('✅ Firebase initialisé avec succès');
        } catch (error) {
            console.error('❌ Erreur initialisation Firebase:', error);
        }

        // Initialiser Firestore (base de données)
        const db = firebase.firestore();

        // Initialiser Auth (authentification)
        const auth = firebase.auth();
        
        // Vérifier que Firebase est bien initialisé
        if (typeof db !== 'undefined') {
            console.log('✅ Firestore (db) est disponible');
        } else {
            console.error('❌ Firestore (db) n\'est pas disponible');
        }
    </script>
    <!-- Leaflet JS pour OpenStreetMap - Chargé à la fin pour garantir le chargement -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Variables globales
        let currentDriverId = null;
        
        // Fonction pour générer un ID unique pour les chauffeurs
        function generateDriverId() {
            return 'DR' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 5).toUpperCase();
        }
        
        // Fonction pour obtenir la date/heure actuelle
        function getCurrentTimestamp() {
            return firebase.firestore.FieldValue.serverTimestamp();
        }
        
        // Fonction de débogage pour vérifier Firebase
        function checkFirebaseConnection() {
            console.log('🔍 Vérification de Firebase...');
            console.log('Firebase disponible:', typeof firebase !== 'undefined');
            console.log('Firestore (db) disponible:', typeof db !== 'undefined');
            
            if (typeof db !== 'undefined') {
                // Tester une requête simple
                db.collection('drivers').limit(1).get()
                    .then(() => {
                        console.log('✅ Connexion Firestore fonctionne');
                    })
                    .catch((error) => {
                        console.error('❌ Erreur connexion Firestore:', error);
                    });
            }
        }
        
        // Vérifier Firebase au chargement de la page
        window.addEventListener('load', () => {
            setTimeout(checkFirebaseConnection, 1000);
        });
        
        // Gestionnaire d'erreurs global pour capturer les erreurs non gérées
        window.addEventListener('error', (event) => {
            console.error('❌ Erreur JavaScript non gérée:', event.error);
            if (event.error && event.error.message && event.error.message.includes('Firebase') || event.error.message.includes('Firestore')) {
                console.error('⚠️ Erreur Firebase détectée:', event.error);
            }
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            console.error('❌ Promise rejetée non gérée:', event.reason);
            if (event.reason && (event.reason.message?.includes('Firebase') || event.reason.message?.includes('Firestore') || event.reason.code === 'permission-denied')) {
                console.error('⚠️ Erreur Firebase dans une Promise:', event.reason);
            }
        });
    </script>
    <script>
        // Initialiser la carte après que Leaflet soit chargé
        (function() {
            function initMapAfterLeaflet() {
                // Vérifier que Leaflet est chargé
                if (typeof L === 'undefined') {
                    setTimeout(initMapAfterLeaflet, 100);
                    return;
                }
                
                // Appeler la fonction d'initialisation globale si elle existe
                if (typeof window.initializeMap === 'function') {
                    window.initializeMap();
                } else {
                    // Si initializeMap n'est pas encore définie, réessayer
                    setTimeout(initMapAfterLeaflet, 200);
                }
            }
            
            // Démarrer l'initialisation après un court délai pour s'assurer que tout est chargé
            if (document.readyState === 'complete') {
                setTimeout(initMapAfterLeaflet, 200);
            } else {
                window.addEventListener('load', function() {
                    setTimeout(initMapAfterLeaflet, 200);
                });
            }
        })();
    </script>
</body>
</html>